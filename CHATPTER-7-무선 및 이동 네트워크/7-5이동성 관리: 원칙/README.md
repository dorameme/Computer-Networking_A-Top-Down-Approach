## 7.5 이동성 관리: 원칙

이동성 관리는 이동 장치가 시간에 따라 네트워크 접속점을 변경하는 과정을 다룬다.    
네트워크 계층에서 이동성은 장치의 활성 상태와 이동 중 발생하는 다양한 문제를 포함한다.

---

## 7.5.1 장치 이동성: 네트워크 계층의 관점

네트워크 계층 관점에서 이동성은 장치의 활성화 상태와 이동 방식에 따라 아래와 같이 분류된다.

### 이동성 유형

#### (a) 네트워크 간 이동 (전원 꺼짐)
- 특징: 이동 장치가 네트워크 사이를 물리적으로 이동하지만, 이동 중에는 전원을 꺼둔다.
- 설명: 전원이 켜져 있을 때 하나의 네트워크에만 접속하고 이동하지 않으므로, 네트워크 관점에서 "모바일 장치"로 간주되지 않는다.

#### (b) 동일 네트워크 내 이동
- 특징: 이동 장치가 물리적으로 이동하지만, 동일한 접속 네트워크에 계속 연결되어 있다.
- 설명: 네트워크 계층 및 링크 계층 관점 모두에서 모바일 장치로 간주되지 않는다. 예를 들어, 동일한 802.11 AP나 LTE 기지국에 연결된 경우이다.

#### (c) 동일 통신 사업자 네트워크 내 이동 (진행 중인 연결 유지)
- 특징: TCP와 같은 상위 레벨 연결을 유지하면서 IP 데이터그램을 송수신한다.
- 핸드오버: 장치가 WLAN 또는 LTE 셀 간을 이동할 때, 네트워크는 하나의 AP/기지국에서 다른 AP/기지국으로 데이터그램을 책임지고 전달한다.

#### (d) 여러 사업자 네트워크 간 이동 (진행 중인 연결 유지)
- 특징: 장치가 여러 통신 사업자 네트워크를 로밍하며 이동한다.
- 설명: 네트워크 간 핸드오버가 필요하며, 사업자 간 협력이 필요하기 때문에 절차가 복잡하다.


### 이동성 유형 비교

| 구분        | 특징                                                                                      | 설명                                                                                       |
|-----------------|--------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|
| (a) 네트워크 간 이동 | 이동 장치가 네트워크 사이를 물리적으로 이동하지만, 이동 중에는 전원을 꺼둔다.                                             | 전원이 켜져 있을 때 하나의 네트워크에만 접속하고 이동하지 않으므로, 네트워크 관점에서 "모바일 장치"로 간주되지 않는다.   |
| (b) 동일 네트워크 내 이동 | 이동 장치가 물리적으로 이동하지만, 동일한 접속 네트워크에 계속 연결되어 있다.                                             | 네트워크 계층 및 링크 계층 관점 모두에서 모바일 장치로 간주되지 않는다. 예: 동일한 802.11 AP나 LTE 기지국에 연결된 경우. |
| (c) 동일 사업자 네트워크 내 이동 | TCP와 같은 상위 레벨 연결을 유지하면서 IP 데이터그램을 송수신한다.                                                   | 핸드오버를 통해 하나의 AP/기지국에서 다른 AP/기지국으로 데이터그램을 전달한다.                                |
| (d) 여러 사업자 네트워크 간 이동 | 장치가 여러 통신 사업자 네트워크를 로밍하며 이동한다.                                                              | 네트워크 간 핸드오버가 필요하며, 사업자 간 협력이 필요하기 때문에 절차가 복잡하다.                                 |


---

## 7.5.2 홈 네트워크 및 방문 네트워크로의 로밍

### 홈 네트워크와 HSS(Home Subscriber Service)

- 홈 네트워크: 사용자가 가입한 통신 사업자로, 이동 장치와 관련된 핵심 정보를 저장하고 관리하는 역할을 한다.
- HSS(Home Subscriber Service): 홈 네트워크의 데이터베이스로, 다음과 같은 정보를 저장한다:
  - 가입자가 이용 가능한 서비스 정보
  - 통신에 필요한 암호화 키
  - 요금 청구 및 과금 정보

### 방문 네트워크로의 로밍

- 방문 네트워크: 홈 네트워크 외의 다른 셀룰러 네트워크에 이동 장치가 연결된 상태를 의미한다.
- 로밍(roaming): 이동 장치가 방문 네트워크에 연결될 때 홈 네트워크와 방문 네트워크 간의 조정 작업이 수행된다.

### 홈 네트워크의 주요 역할

1. 정보 제공: 홈 네트워크는 이동 장치에 대한 정보를 저장하고 이를 방문 네트워크에 제공하여 원활한 서비스 제공을 지원한다.
2. 조정 지점 역할: 로밍 중인 이동 장치와의 통신을 위해 홈 네트워크는 방문 네트워크와 조정을 수행한다.
   - 예: 인증 절차와 서비스 권한 부여.

---
## 7.5.3 이동 장치로의 직접 라우팅과 간접 라우팅

이동 네트워크 구조는 인터넷이나 셀룰러 네트워크에서 이동 장치가 위치를 변경해도 원활한 통신을 유지하도록 설계된다. 이를 위해 두 가지 주요 라우팅 방식이 사용된다: 간접 라우팅과 직접 라우팅.

---

### 이동 네트워크의 구성 요소

모든 이동 장치는 고유 식별자를 가지며, 다음과 같은 구조를 통해 통신이 이루어진다:

1. IMSI: 4G LTE에서 사용되는 국제 이동 가입자 식별자로, SIM 카드에 저장된다.
2. IP 주소: 홈 네트워크에서 부여된 영구 IP 주소 및 방문 네트워크에서 임시로 할당된 IP 주소.
3. HSS(Home Subscriber Service): 이동 장치의 위치와 서비스 정보를 관리하는 홈 네트워크의 데이터베이스.

---

### IMSI와 MAC 주소의 차이 및 필요성

| 구분       | IMSI (International Mobile Subscriber Identity) | MAC 주소 (Media Access Control Address)         |
| ------------ | --------------------------------------------------- | ------------------------------------------------- |
| 정의       | 국제 이동 가입자 식별 번호로, 이동 통신 가입자를 고유하게 식별하기 위해 사용됨       | 네트워크 인터페이스 카드(NIC)의 하드웨어 주소로, LAN 환경에서 기기 식별에 사용됨 |
| 범위       | 전 세계적으로 고유하며, 셀룰러 네트워크 가입자를 식별하는 데 사용됨              | 로컬 네트워크(LAN/WLAN)에서만 유효함                          |
| 사용 목적    | 가입자의 네트워크 인증 및 이동 통신 서비스 제공                         | 네트워크 장치 간 데이터 프레임 전송 및 식별                         |
| 변경 가능 여부 | 고정적이며, 일반적으로 SIM 카드에 저장되어 변경 불가능                    | 사용자에 의해 변경 가능 (MAC 스푸핑 가능)                        |
| 적용 사례    | 4G/5G 네트워크에서 사용자 추적, 인증, 과금                         | 와이파이, 이더넷 등 로컬 네트워크 연결                            |

---

### 간접 라우팅과 직접 라우팅 비교

| 구분     | 간접 라우팅 (Indirect Routing)                        | 직접 라우팅 (Direct Routing)                         |
| ---------- | ---------------------------------------------------- | --------------------------------------------------- |
| 데이터 흐름 | 데이터그램이 홈 네트워크를 거쳐 방문 네트워크로 전달됨                       | 데이터그램이 통신자에서 방문 네트워크로 직접 전달됨                        |
| 장점     | 1. 통신자는 이동 장치의 위치를 알 필요가 없음 2. 구현이 단순하고 투명한 통신 환경 제공 | 1. 데이터그램이 최적 경로를 사용             2.  삼각 라우팅 문제 해결    |
| 단점     | 1. 삼각 라우팅으로 인해 비효율 발생- 데이터 전송 경로가 길어짐                | 1. 통신자가 이동 장치의 위치를 지속적으로 갱신해야 함 2. 복잡한 프로토콜 및 관리 필요 |
| 사용 사례  | 이동 장치가 위치를 자주 변경하는 환경                                | 이동 장치가 위치를 덜 변경하거나 효율이 중요한 환경                       |
| 복잡성    | 상대적으로 낮음                                             | 상대적으로 높음                                            |

---

### 1. 간접 라우팅 (Indirect Routing)

간접 라우팅에서는 데이터그램이 항상 이동 장치의 홈 네트워크를 통해 방문 네트워크로 전달된다. 이는 통신자에게 이동 장치의 현재 위치를 숨기고, 투명한 통신 환경을 제공한다.

#### 과정

1. 데이터그램 전송: 통신자는 이동 장치의 영구 IP 주소를 목적지로 설정하고 데이터를 전송한다.
2. 홈 네트워크의 처리:
   - 홈 네트워크의 게이트웨이가 데이터그램을 가로채 HSS와 협력하여 이동 장치의 현재 위치(방문 네트워크)를 파악한다.
   - 데이터그램을 방문 네트워크로 재라우팅(rerouting)한다.
3. 방문 네트워크의 처리:
   - 방문 네트워크 게이트웨이는 데이터그램을 캡슐화 해제하여 이동 장치로 전달한다.

#### 장점

- 투명성: 통신자는 이동 장치의 위치를 몰라도 통신이 가능하다.
- 간소화: 네트워크가 이동 장치의 위치 정보를 관리한다.

#### 단점

- 삼각 라우팅 문제: 데이터그램이 홈 네트워크를 거쳐야 하므로 최적 경로가 아니라 비효율적이다.

---

### 2. 직접 라우팅 (Direct Routing)

직접 라우팅에서는 통신자가 이동 장치의 현재 위치를 직접 조회하여 데이터를 전송한다.

이는 삼각 라우팅 문제를 해결하지만, 추가적인 프로토콜과 복잡성이 요구된다.

#### 과정

1. 위치 조회: 통신자는 이동 장치의 홈 네트워크(HSS)에 질의하여 방문 네트워크의 위치를 파악한다.
2. 데이터 전송: 통신자는 데이터를 방문 네트워크로 직접 터널링하여 전달한다.
   - 터널링(Tunneling): 네트워크 간에 데이터를 캡슐화하여 안전하고 효율적으로 전달하는 기술. 이는 원래의 데이터그램을 새로운 데이터그램 안에 넣어 전달하며, 수신 네트워크에서 캡슐화를 해제하여 데이터를 원래 상태로 복원한다.

#### 장점

- 효율성: 데이터그램이 최적 경로를 통해 전달된다.

#### 단점

- 복잡성: 통신자가 이동 장치의 위치를 계속 갱신해야 하므로 추가적인 프로토콜이 필요하다.
- 관리 어려움: 이동 장치가 네트워크를 변경할 때 통신자에게 새로운 정보를 전달해야 한다.

#### 추가 문제와 해결

- 문제 1: 위치 정보 갱신
  - 이동 장치가 방문 네트워크를 바꿀 때마다 통신자가 새로운 위치를 알아야 합니다.
  - 간접 라우팅 해결: 홈 네트워크의 HSS가 자동으로 갱신되며, 터널 종단점을 새로운 방문 네트워크로 전환합니다.
  - 직접 라우팅 문제: 통신자가 HSS에 질의한 후 변경된 정보를 실시간으로 갱신하는 추가 프로토콜이 필요합니다.

- 문제 2: 데이터 전송 경로
  - 통신자가 변경된 방문 네트워크로 데이터를 전송해야 합니다.
  - 간접 라우팅 해결: HSS와 홈 네트워크가 이를 관리하여 투명성을 제공합니다.
  - 직접 라우팅 문제: 세션 시작 시 한 번만 위치 정보를 조회하므로 이후의 변화를 처리하기 어렵습니다.

---

### 네트워크 계층에서의 주요 프로토콜

1. 이동 장치와 방문 네트워크 간의 결합 프로토콜:

   - 이동 장치는 방문 네트워크에 연결 및 해제 과정을 수행해야 한다.

2. 방문 네트워크와 홈 네트워크 간의 HSS 등록 프로토콜:

   - 방문 네트워크는 이동 장치의 위치 정보를 홈 네트워크에 등록한다.

3. 홈 네트워크와 방문 네트워크 간의 데이터그램 터널링 프로토콜:

   - 홈 네트워크 게이트웨이는 데이터그램을 캡슐화하여 방문 네트워크로 전달하며, 방문 네트워크 게이트웨이는 이를 해제하여 이동 장치로 전달한다.

---

### 삼각 라우팅 문제 (Triangle Routing Problem)

- 정의: 간접 라우팅 방식에서는 데이터그램이 항상 홈 네트워크를 거쳐 방문 네트워크로 전달되므로, 최적 경로를 사용하지 못하는 비효율성이 발생한다.
- 해결 방법: 직접 라우팅 방식을 통해 해결할 수 있지만, 이는 추가적인 관리 부담과 복잡성을 초래한다.

---

### 결론

간접 라우팅과 직접 라우팅은 각각 장단점이 있다. 간접 라우팅은 구현이 간단하지만 비효율적이고, 직접 라우팅은 최적 경로를 제공하지만 관리와 프로토콜 복잡성이 증가한다.

네트워크 환경에 따라 적합한 방식을 선택하는 것이 중요하다.


