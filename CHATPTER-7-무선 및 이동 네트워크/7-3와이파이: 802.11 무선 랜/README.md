## 7.3 와이파이: 802.11 무선 랜
LAN, WLAN, Wi-Fi는 모두 OSI 2계층(데이터 링크 계층)에 해당한다.

### WLAN과 LAN의 차이

#### 1. WLAN (Wireless Local Area Network)
- 정의: 무선 네트워크로, 물리적 케이블 없이 전파를 통해 데이터를 송수신한다.
- 특징:
  - 이동성과 유연성이 높아 사용자가 자유롭게 이동하면서 네트워크에 연결 가능하다.
  - 데이터 전송 시 간섭 및 신호 감쇠, 다중 경로 등의 문제가 발생할 수 있다.
  - 충돌 탐지가 어려운 환경이므로 CSMA/CA와 같은 충돌 회피(Avoidance) 방식을 사용한다.
- 적용 기술: Wi-Fi(802.11), Bluetooth 등.

#### 2. LAN (Local Area Network)
- 정의: 물리적 케이블을 사용하여 네트워크를 구성한 유선 네트워크이다.
- 특징:
  - 안정적이고 높은 데이터 전송 속도를 제공한다.
  - 충돌 탐지가 쉬운 환경이므로 CSMA/CD와 같은 충돌 탐지(Detection) 방식을 사용한다.
  - 보안이 더 강력하고 외부 간섭이 거의 없다.
- 적용 기술: 이더넷(802.3) 기반 네트워크.

#### 3. WLAN과 LAN의 주요 차이 비교표

| 구분          | WLAN                                | LAN                                |
|---------------|-------------------------------------|-------------------------------------|
| 연결 방식 | 무선 (전파, 적외선 등)               | 유선 (케이블)                      |
| 설치 용이성 | 쉬움 (추가 케이블 필요 없음)          | 복잡함 (케이블 설치 필요)           |
| 이동성    | 이동 가능                            | 제한적                             |
| 충돌 처리 | CSMA/CA (충돌 회피)                  | CSMA/CD (충돌 탐지)                 |
| 속도      | 비교적 낮음                          | 빠름                               |
| 안정성    | 간섭, 감쇠, 다중 경로 등의 문제 발생 가능 | 신호 간섭이 거의 없음              |
| 보안      | 무선 암호화 필요 (WPA, WPA2 등)       | 물리적 접근 제어로 보안성 높음      |

#### 4. WLAN과 LAN 선택 시 고려 사항
- 유연성이 중요하다면 WLAN 선택.
- 속도와 안정성이 중요하다면 LAN 선택.
- 보안 문제가 민감하다면 LAN이 더 적합.

LAN은 유선 또는 무선 네트워크를 모두 포함하는 개념이다. WLAN은 LAN의 무선 버전이다. Wi-Fi는 WLAN을 구현하는 기술이다. 
## 1. 설명
### IEEE 802.11 표준안

- IEEE 802.11 표준은 무선 네트워크를 위한 기술 표준이다.
- 802.11b, g, n, ac, ax 표준으로 발전해 왔다.
- 일반적으로 거리가 70m 미만인 영역에서 동작하는 WLAN 용도로 사용된다.
- 이전 표준과의 역방향 호환성을 제공한다.
  - 예: 802.11g 기능만을 갖는 이동 단말도 802.11ac 또는 802.11ax 기지국과 상호작용이 가능하다.
- 모두 CSMA/CA라는 동일한 매체 접속 프로토콜을 사용한다. \
  다만, 이는 IEEE 802.11 표준에서 정의된 무선 네트워크의 경우에 해당하며, \
  모든 LAN(Local Area Network)이 이 프로토콜을 사용하는 것은 아니다.

---

## 2. 예시

### 주파수 영역

1. 2.4 GHz 대역

   - 낮은 주파수로 인해 긴 신호 범위를 제공하지만 간섭에 취약하다.
   - 주요 용도: 가정용 라우터, 블루투스 장치 등.

2. 5 GHz 대역

   - 높은 주파수로 인해 더 많은 대역폭과 빠른 전송 속도를 제공한다.
   - 주요 용도: 고속 데이터 전송을 요구하는 환경.

---

## 3. 동작 방식

### 안테나 기술
 <img width="600" alt="Image" src="https://github.com/user-attachments/assets/b987ab64-1863-4e46-86bc-cc243e35548c" />

1. MIMO (Multiple Input Multiple Output)

   - 다중 안테나를 사용하여 데이터 전송 속도와 신뢰성을 높이는 기술이다.
   - 예: 802.11n, 802.11ac 표준에서 주로 사용됨.

2. 스마트 안테나

   - 빔포밍(Beamforming) 기술을 활용하여 특정 방향으로 신호 강도를 높임.
   - 신호 간섭을 줄이고 효율성을 극대화함.




### 데이터 링크 계층(Layer 2):
- MAC(Media Access Control): 데이터 전송 제어와 네트워크 접근 제어를 담당한다.
- 프레임 구조와 CSMA/CA 같은 충돌 회피 메커니즘이 여기에서 구현된다.
- WLAN의 로밍, AP 간 핸드오프 같은 기능도 이 계층에서 이루어진다.

### 물리 계층(Layer 1):
- 신호 전송, 주파수 대역, 변조 방식 등 실제 무선 신호의 송수신을 담당한다.


## 무선랜이 2계층인 이유
### 1. MAC 프로토콜 구현
- CSMA/CA로 무선 채널 접근 제어
- 여러 기기의 동시 전송 충돌 회피

### 2. 프레임 기반 통신
- MAC 주소로 기기 식별
- 프레임 단위로 데이터 전송
- 오류 검출용 CRC 포함

### 3. 신뢰성 보장
- ACK로 전송 성공 확인
- 오류시 프레임 재전송

### 4. 계층간 연결
- 1계층(물리계층)의 신호를 3계층(네트워크)이 사용 가능한 형태로 변환
- AP를 통해 유선 네트워크와 연결802.11 무선 랜(WLAN)은 현대의 무선 네트워크 기술 중 가장 널리 사용되는 표준이다.
- 이 기술은 사용자가 유선 연결 없이도 데이터를 전송하고 네트워크에 접근할 수 있도록 한다.

---

#### 7.3.1 802.11 WLAN 구조

802.11 WLAN의 기본 구조는 크게 두 가지로 나뉜다: 인프라 모드와 애드혹(Ad-hoc) 모드이다.

1. 인프라 모드:

   - 무선 액세스 포인트(AP)가 중심 역할을 하여 클라이언트 장치들이 네트워크에 연결된다.
   - 예: 가정용 와이파이 네트워크에서 라우터가 AP 역할을 한다.

2. 애드혹 모드:

   - AP 없이 디바이스들 간에 직접 연결된다.
   - 예: 두 스마트폰이 직접 연결되어 파일을 전송하는 경우.

---

#### 7.3.2 802.11 MAC 프로토콜

802.11의 MAC(Media Access Control) 프로토콜은 데이터를 효율적으로 송수신하기 위한 규칙을 정의한다.

1. CSMA/CA(Carrier Sense Multiple Access with Collision Avoidance):

   - 데이터를 전송하기 전에 채널이 사용 중인지 확인하고 충돌을 방지한다.
   - 예: 사람이 대화할 때 서로 말을 겹치지 않으려고 잠시 기다리는 것과 유사하다.

2. RTS/CTS(Ready to Send / Clear to Send):

   - 충돌이 발생할 가능성이 높은 상황에서 사용된다.
   - 예: 대화하기 전 "이야기 좀 해도 될까요?"라고 물어보는 과정.

---

#### 7.3.3 IEEE 802.11 프레임

802.11 프로토콜의 프레임 구조는 네트워크 데이터를 전달하는 데 중요한 역할을 한다. 주요 필드는 다음과 같다:

1. 프레임 제어: 데이터 프레임의 종류와 기능을 정의한다.
2. 주소 필드: 송신자, 수신자, AP 주소를 포함한다.
3. 데이터 필드: 실제 전송할 데이터를 포함한다.

예를 들어, 이메일을 전송할 때 프레임 제어는 이메일 유형을, 주소 필드는 발신자와 수신자 주소를, 데이터 필드는 이메일 본문을 담는다.

---

#### 7.3.4 동일한 IP 서브넷 내에서의 이동성

802.11은 동일한 IP 서브넷 내에서 사용자가 이동하더라도 연결을 유지할 수 있다. 이를 로밍(Roaming)이라 한다.

1. 핸드오프(Handoff): 사용자가 한 AP에서 다른 AP로 이동할 때 연결을 전환하는 과정이다.

   - 예: 스마트폰을 들고 집 안을 걸어 다닐 때도 와이파이 연결이 유지되는 상황.

2. Layer 2와 Layer 3 이동성: 데이터 링크 계층과 네트워크 계층에서의 연결 전환이 원활히 이루어진다.

---

#### 7.3.5 802.11의 고급 특징

802.11 표준은 기본 연결 외에도 여러 고급 기능을 제공한다:


2. QoS(Quality of Service):

   - 다양한 데이터 유형(음성, 영상 등)에 우선순위를 부여하여 전송 품질을 보장한다.
   - 예: 영상 통화 시 끊김 없이 대화가 지속되는 것.

3. WPA3 보안:

   - 최신 무선 네트워크 보안 표준으로, WPA2보다 강화된 암호화를 제공한다.

---

#### 7.3.6 PAN(Personal Area Network): 블루투스
블루투스와 Wi-Fi는 서로 다른 기술이지만, 둘 다 무선 통신 기술에 속함.
블루투스는 짧은 거리에서 디바이스 간 데이터를 전송하는 데 사용되는 PAN 기술이다.

1. 주요 특징:

   - 최대 10미터 거리에서 저전력으로 데이터 전송.
   - 예: 무선 이어폰과 스마트폰 연결.

2. 블루투스 프로파일:

   - 디바이스 간 상호 운용성을 정의한다.
   - 예: A2DP(Advanced Audio Distribution Profile)는 고품질 오디오 전송에 사용된다.

3. BLE(Bluetooth Low Energy):

   - 저전력으로 센서 디바이스를 연결하는 데 적합하다.
   - 예: 스마트워치가 건강 데이터를 스마트폰으로 전송.

---
SSID와 채널 번호는 무선 네트워크에서 중요한 역할을 한다. 그 이유는 다음과 같다:

1. SSID (Service Set Identifier):

   - SSID는 무선 네트워크의 이름을 식별하는 고유한 값이다.
   - SSID는 무선 네트워크를 찾고, 사용자나 장치가 특정 네트워크에 연결할 수 있도록 도와준다.
   - 예를 들어, 여러 개의 Wi-Fi 네트워크가 있을 때, 각 네트워크는 고유한 SSID를 통해 구분된다. 사용자는 이 SSID를 보고 연결할 네트워크를 선택한다.

2. 채널 번호:

   - 채널 번호는 무선 주파수 대역에서 데이터 전송을 위한 특정 범위를 지정한다.

   - 802.11 표준에서 사용되는 주파수 대역(예: 2.4GHz)은 여러 개의 채널로 나누어진다. 각 채널은 독립적으로 데이터를 송수신할 수 있는 범위를 제공한다.

   - 서로 다른 채널을 사용함으로써, 근처의 AP들이 서로 간섭을 줄이고 효율적으로 통신할 수 있다. 채널 간 간격이 적당히 넓어야 서로 겹치지 않도록 하여 성능 저하를 방지한다.

   - SSID 중복 가능성과 사용자 설정: SSID는 사용자가 임의로 설정할 수 있으며, 동일한 SSID를 가진 네트워크가 중복될 수 있다.      
동일한 SSID를 사용하는 네트워크가 있을 경우, 장치는 신호 강도, 보안 설정, MAC 주소 등의 추가 정보를 통해 연결할 네트워크를 결정한다.     
예를 들어, 공공 장소에서 "Free WiFi"라는 SSID가 여러 AP에서 사용될 수 있지만, 각 AP는 고유한 MAC 주소를 기준으로 구분된다.      
무선 스테이션이 SSID가 같은 네트워크를 검색하면, 신호 강도가 높은 AP를 우선으로 연결하려고 시도하며, 추가적으로 MAC 주소를 사용해 원하는 AP와 연결을 확정한다.     

   - AP란 무엇인가?: AP는 Access Point의 약자로, 네트워크에서 무선 장치들이 유선 네트워크에 연결할 수 있도록 해주는 엑세스 포인트이다.       
   -  Wi-Fi 라우터는 AP의 한 예로, 단순히 무선 신호를 제공하는 역할 외에도 라우팅, NAT, DHCP와 같은 네트워크 관리 기능을 수행한다.       
   -   순수한 AP는 유선 네트워크를 무선으로 변환하는 역할만 하며, 라우터와는 달리 추가적인 네트워크 관리 기능은 없다.

따라서, SSID는 네트워크를 구분하고 연결할 수 있도록 도와주며,

채널 번호는 주파수 간섭을 피하고 효율적인 통신을 가능하게 한다.

---

### Wi-Fi 정글(Wi-Fi Jungle):

- Wi-Fi 정글은 많은 AP와 네트워크가 한 공간에 밀집되어 있는 환경을 지칭하는 용어이다.
- 이러한 환경에서는 SSID와 채널 번호의 충돌 및 간섭이 빈번하게 발생한다.

#### 문제점:

1. 주파수 간섭:

   - AP들이 서로 가까이 위치하여 동일하거나 인접한 채널을 사용할 경우, 신호 간 간섭이 발생해 네트워크 성능이 저하된다.
   - 특히 2.4GHz 대역은 사용 가능한 채널이 적어 간섭 문제가 심각하다.

2. SSID 혼잡:

   - 많은 AP가 동일하거나 비슷한 SSID를 사용할 경우, 사용자가 원하는 네트워크를 선택하기 어려워진다.
   - 사용자가 잘못된 AP에 연결될 가능성이 높아진다.

3. 보안 문제:

   - 공공 장소에서 악성 AP가 "Free WiFi"와 같은 이름으로 사용자를 속여 연결을 유도할 수 있다.

#### 해결 방안:

1. 채널 관리:

   - AP 간 채널 간격을 충분히 넓게 설정하여 간섭을 최소화한다.
   - 5GHz 대역 사용을 권장하여 간섭을 줄인다.

2. SSID 구분:

   - SSID를 고유하고 명확하게 설정하여 사용자가 원하는 네트워크를 쉽게 선택할 수 있도록 한다.
   - 예: "Cafe\_WiFi\_1"과 같은 구체적인 이름 사용.

3. 보안 강화:

   - WPA3와 같은 최신 보안 프로토콜을 사용하여 네트워크 안전성을 높인다.
   - 공공 장소에서 AP의 신뢰성을 확인하도록 사용자에게 안내한다.

---

## 수동적 스캐닝과 능동적 스캐닝

### 비컨프레임

1. 기능: 비컨프레임은 무선 환경에서 주로 사용. 네트워크 정보(SID, 보안 설정 등)를 주기적으로 방송하고 디바이스 동기화를 지원한다.  
2. 역할: AP에서 무선 네트워크 연결 관리와 장치 간 통신을 원활히 유지한다.  
3. 예시: Wi-Fi 스캔 시 네트워크 목록 표시, AP와 디바이스 간 시간 동기화.


#### 1. 수동적 스캐닝 (Passive Scanning):

- 무선 스테이션이 AP에서 주기적으로 전송하는 비컨 프레임을 수신하여 AP를 탐색하는 방식이다.
- 동작 과정:
  1. AP가 약 100밀리초 간격으로 비컨 프레임을 방송한다.
  2. 무선 스테이션은 주변의 비컨 프레임을 수신하여 AP 정보를 확인한다.
  3. 스테이션은 신호 강도, 보안 설정 등을 기준으로 AP를 선택해 연결한다.

#### 2. 능동적 스캐닝 (Active Scanning):

- 무선 스테이션이 직접 프로브 프레임을 방송하여 주변 AP로부터 응답을 요청하는 방식이다.
- 동작 과정:
  1. 무선 스테이션(H1)이 탐사용 프로브 프레임을 방송한다.
  2. AP들은 이 요청을 받고 프로브 응답 메시지를 전송한다.
  3. H1은 응답받은 AP 중 최적의 AP를 선택해 결합 요청 메시지를 전송한다.
  4. 선택된 AP는 결합 수락 메시지를 전송하여 연결을 완료한다.

#### 공통점:

- 두 방식 모두 AP를 탐색하고 연결하는 데 사용된다.
- AP의 정보(SSID, 채널, MAC 주소 등)를 기반으로 연결할 AP를 결정한다.

#### 차이점:

| 방식             | 수동적 스캐닝              | 능동적 스캐닝                      |
| -------------- | -------------------- | ---------------------------- |
| 탐색 방법      | AP가 방송하는 비컨 프레임을 수신함 | 스테이션이 프로브 프레임을 방송하여 AP 응답 요청 |
| 네트워크 부하    | 비교적 낮음               | 프로브 프레임 전송으로 부하가 증가          |
| 탐색 속도      | 상대적으로 느림             | 상대적으로 빠름                     |
| 주요 사용 시나리오 | 전력 소모를 줄이고자 할 때 사용   | 신속한 연결이 필요할 때 사용             |

---

### 결합 후 과정:

1. IP 주소 할당:

   - 결합이 완료된 무선 스테이션은 AP를 통해 서브넷으로 DHCP 발견 메시지를 전송한다.
   - AP는 DHCP 서버와 통신하여 무선 스테이션에 고유 IP 주소를 할당한다.
   - 무선 스테이션은 이 IP 주소를 통해 서브넷 내 호스트로 동작하며 인터넷에 연결된다.

2. 인증 과정:

   - 일부 AP는 무선 스테이션이 연결 전에 인증을 요구한다.

     인증 방식:
     - MAC 주소를 기반으로 접근 제어.
     - 사용자 이름과 비밀번호를 사용한 인증.
   - AP는 인증 서버(RADIUS, DIAMETER 등)와 통신하여 인증을 수행한다.

---

### 7.3.2 802.11 MAC 프로토콜

#### 개념

802.11 MAC 프로토콜은 무선 LAN에서 데이터를 송수신하기 위해 사용되는 프로토콜이다. 주요 기능으로는 채널 접근 제어, 데이터 프레임의 전송 및 재전송, 충돌 방지 등이 포함된다. 무선 환경에서의 특수한 문제를 해결하기 위해 설계되었다.

#### 동작 원리

802.11 MAC 프로토콜의 동작 원리는 다음과 같다:

1. 다중 접속 프로토콜 분류

   - 채널 분할 (e.g., CDMA): 주파수, 시간 또는 코드에 따라 채널을 나누어 데이터를 전송한다.
   - 랜덤 접속: 충돌이 발생할 수 있지만, 랜덤 백오프를 통해 데이터를 전송한다.
   - 순번제: 각 노드에 전송 순서를 부여하여 충돌을 방지한다.

2. CSMA/CA

   - Carrier Sense Multiple Access with Collision Avoidance: 송신 전에 채널을 확인하여 충돌을 방지하는 방식이다.
   - RTS와 CTS: 숨은 터미널 문제를 해결하기 위해 송신자는 Request To Send(RTS) 메시지를 보내고, 수신자는 Clear To Send(CTS) 메시지로 응답한다.

3. 링크 계층 ACK

   - 데이터 프레임 전송 후, 수신자가 ACK를 전송하여 프레임이 정상적으로 수신되었음을 확인한다.

#### 주요 구성 요소

1. Payload와 CRC 필드

   - Payload: 실제 데이터가 포함된 부분이다.
   - CRC (Cyclic Redundancy Check): 데이터 무결성을 확인하기 위한 오류 검출 코드이다.

2. 주소 필드

   - 송신자와 수신자의 MAC 주소를 포함한다.

#### MAC 프로토콜의 범용성

MAC (Media Access Control) 프로토콜은 무선 LAN뿐만 아니라 유선 네트워크에서도 사용된다. MAC 프로토콜은 네트워크의 링크 계층에서 동작하며, 네트워크 장치 간 데이터 전송을 제어하는 역할을 한다.

다만, 802.11 MAC 프로토콜은 무선 LAN(WLAN) 환경에 특화되어 설계된 프로토콜로, 무선 환경의 특수한 문제(예: 숨은 터미널, 충돌 회피 등)를 해결하기 위한 메커니즘(예: CSMA/CA, RTS/CTS 등)을 포함한다.

반면, 유선 네트워크에서는 충돌 문제를 해결하기 위해 CSMA/CD(Carrier Sense Multiple Access with Collision Detection) 방식을 주로 사용하며, 전반적으로 충돌 가능성이 무선보다 낮기 때문에 MAC 프로토콜의 동작 방식이 더 간단하다.

#### 왜 무선은 CSMA/CA를 사용하고 유선은 CSMA/CD를 사용하는가?

1. CSMA/CD (유선 네트워크)

   - 이유: 유선 네트워크에서는 충돌이 발생하더라도 전송 신호가 물리적인 케이블을 통해 전달되므로 충돌을 쉽게 탐지할 수 있다. 충돌이 감지되면 즉시 전송을 중단하고, 랜덤 백오프 후 다시 전송을 시도한다.
   - 환경: 유선 네트워크는 신호 감쇠가 적고, 충돌 탐지가 비교적 쉬운 환경이다.

2. CSMA/CA (무선 네트워크)

   - 이유: 무선 네트워크에서는 충돌을 감지하기 어렵다. 이는 무선 신호가 공간에 퍼지며, 숨은 터미널 문제와 같은 특수한 상황이 발생하기 때문이다. 따라서 충돌을 "피하는(Avoidance)" 방식인 CSMA/CA를 사용하여 송신 전에 채널 상태를 확인하고, RTS/CTS를 통해 데이터 전송을 조율한다.
   - 환경: 무선 네트워크는 신호 감쇠, 간섭, 다중 경로와 같은 문제가 존재하며, 충돌 탐지보다는 충돌 회피가 더 효율적이다.

#### 정리 및 비교표

| 분류        | 설명                            | 장점           | 단점             |
| --------- | ----------------------------- | ------------ | -------------- |
| 채널 분할     | 주파수, 시간, 코드로 채널을 나누어 데이터 전송   | 충돌 없음        | 채널 자원의 비효율적 사용 |
| 랜덤 접속     | 충돌 발생 가능성이 있으나 랜덤 백오프 사용      | 구현이 간단       | 충돌 가능성         |
| 순번제       | 각 노드에 전송 순서를 부여하여 충돌 방지       | 충돌 없음        | 전송 지연 발생 가능    |
| CSMA/CA   | 송신 전에 채널을 확인하고 충돌을 방지         | 효율적이고 실용적    | 숨은 터미널 문제 존재   |
| CSMA/CD   | 충돌 발생 시 이를 탐지하고 재전송 시도        | 간단하고 효율적     | 무선 환경에서는 비효율적  |
| RTS와 CTS  | 숨은 터미널 문제 해결 방안으로, 데이터 충돌을 방지 | 숨은 터미널 문제 해결 | 오버헤드 증가        |
| 링크 계층 ACK | 데이터 프레임 수신 확인                 | 신뢰성 보장       | 추가적인 전송 오버헤드   |

## 숨은 터미널 문제 해결: RTS와 CTS

### 1. RTS와 CTS 프레임

#### 특징

- RTS(Request to Send)와 CTS(Clear to Send) 프레임은 무선 네트워크에서 충돌 방지를 위해 사용되는 제어 프레임이다.
- 숨은 스테이션 문제(Hidden Station Problem)를 완화하고, 데이터 프레임 전송의 안정성을 높이는 역할을 한다.

#### 동작 방식

1. RTS 프레임 전송: 송신 스테이션이 데이터 전송을 요청하기 위해 RTS 프레임을 전송한다.
2. CTS 프레임 수신: 수신 스테이션이 채널 사용을 허가하면 CTS 프레임을 송신 스테이션에 전송한다.
3. DATA 전송: 송신 스테이션이 허가를 받은 후 DATA 프레임을 전송한다.
4. ACK 전송: 수신 스테이션이 데이터 수신을 확인한 뒤 ACK 프레임을 송신 스테이션으로 전송한다.

#### 장점

1. 숨은 스테이션 문제를 완화하여 데이터 전송 충돌을 줄인다.
2. RTS와 CTS 프레임은 길이가 짧아, 충돌 시 재전송 부담이 적다.
3. RTS/CTS 교환 이후에는 DATA와 ACK 프레임이 충돌 없이 안정적으로 전송된다.

#### 단점

1. 추가적인 지연: RTS/CTS 교환으로 인해 데이터 전송 전에 시간이 소요된다.
2. 채널 자원 낭비: 짧은 데이터 전송 시 RTS/CTS 교환이 불필요한 오버헤드를 발생시킨다.

#### 예시

- 길이가 긴 데이터 프레임을 전송할 때 RTS/CTS를 사용하면 충돌로 인한 재전송 비용을 줄일 수 있다.
- 짧은 데이터 프레임의 경우 RTS/CTS 교환을 생략하여 효율성을 높인다.

#### 비교표: RTS/CTS 사용 여부

| 구분       | RTS/CTS 사용 | RTS/CTS 미사용 |
| ------------ | -------------- | --------------- |
| 충돌 방지 효과 | 숨은 스테이션 문제 완화  | 숨은 스테이션 문제 발생   |
| 전송 지연    | 증가             | 감소              |
| 채널 자원 활용 | 추가 자원 소모       | 효율적             |
| 적용 대상    | 긴 DATA 프레임     | 짧은 DATA 프레임     |

---

### 2. 802.11의 점대점 링크 활용

#### 특징

- 무선 네트워크의 두 노드 간 직접 연결(Point-to-Point Link)을 형성할 수 있다.
- 지향성 안테나(directional antenna)와 802.11 프로토콜을 사용하여 효율적인 데이터 전송이 가능하다.

#### 동작 방식

1. 두 노드가 지향성 안테나를 사용해 서로를 가리킨다.
2. 링크가 형성된 후, 802.11 프로토콜을 실행하여 데이터 송수신을 진행한다.

#### 장점

1. 장거리 연결 가능: 지향성 안테나와 높은 전송 전력을 활용하여 수십 km 거리의 무선 연결을 제공할 수 있다.
2. 저렴한 비용: 기존 802.11 하드웨어를 활용하여 경제적인 점대점 연결을 구현할 수 있다.
3. 유연성: 물리적 케이블 연결 없이 네트워크 확장이 가능하다.

#### 단점

1. 설치 복잡성: 지향성 안테나의 정확한 방향 설정이 필요하다.
2. 환경 의존성: 장애물이나 날씨의 영향을 받을 수 있다.
3. 제한된 대역폭: 공유 채널 사용으로 인해 대역폭 경쟁이 발생할 수 있다.

#### 예시

- 농촌 지역 또는 외곽 지역에서 인터넷 연결을 위해 점대점 무선 링크를 사용하는 사례.
- 기업 캠퍼스 간 데이터 전송을 위한 저비용 솔루션.

#### 비교: 802.11 점대점 링크 vs 애드혹 네트워크

| 구분          | 802.11 점대점 링크                  | 애드혹 네트워크               |
| ----------------- | ------------------------------------- | -------------------------------- |
| 구조          | 두 노드 간 고정된 연결                | 여러 노드 간 동적 연결           |
| 라우팅        | 필요 없음                            | 노드가 라우팅 역할 수행         |
| 확장성        | 제한적                               | 높음                            |
| 장거리 전송   | 수십 km 가능                         | 일반적으로 단거리               |
| 설치 난이도   | 지향성 안테나 조정 필요                | 별도 장비 없이 설치 가능         |


---

### 7.3.3 IEEE 802.11 프레임

802.11 프레임은 이더넷 프레임과 유사하지만, 무선 링크 사용에 특화된 몇 가지 필드를 포함하고 있다. 무선 환경에서의 데이터 전송 및 오류 검출에 최적화된 구조를 가진다.

---

### 1. Payload 및 CRC 필드

- Payload: 보통 하나의 IP 데이터그램이나 ARP 패킷을 포함하며, 최대 2,312바이트까지 허용된다. 이는 802.11 프레임의 데이터 전송량을 결정하는 핵심 요소이다.
- CRC: 32비트 순환 중복 검사(CRC)를 통해 프레임 수신 시 발생할 수 있는 비트 오류를 검출한다. 무선 랜에서 발생 빈도가 높은 비트 오류를 효과적으로 처리할 수 있다.

---

### 2. 주소 필드

802.11 프레임은 네트워크 연동 및 무선 환경에서의 데이터 전송을 위해 4개의 주소 필드를 포함한다. 각 필드는 6바이트의 MAC 주소를 저장하며, 다음과 같은 역할과 동작 방식을 가진다:

#### Address 1

- 역할: 프레임의 목적지 무선 스테이션을 나타낸다.

#### Address 2

- 역할: 프레임을 전송하는 스테이션의 발신자 정보를 포함한다.

#### Address 3

- 역할: BSS와 유선 네트워크를 연결하는 라우터 인터페이스의 MAC 주소를 식별한다.

#### Address 4

- 역할: 애드혹 네트워크 모드에서 노드 간 통신을 지원한다.

---

### 3. 주소 필드의 사용 예시

#### 비유: 택배 전달 시스템

802.11 주소 필드의 동작 방식을 택배 시스템으로 비유할 수 있다. 

- Address 1: 택배가 배달될 최종 수령인의 주소이다.
  - 예: 고객의 집 주소.
- Address 2: 택배를 발송한 사람의 주소이다.
  - 예: 판매자의 창고 주소.
- Address 3: 배송이 중간에 거치는 물류 센터 주소이다.
  - 예: 지역 물류 창고.
- Address 4: 특정 상황(예: 고객이 직접 픽업)을 위해 사용되는 추가적인 정보이다.

![image](https://github.com/user-attachments/assets/320b44a4-0985-4540-a102-5a0e84984ec1)

#### 1️ 라우터 인터페이스 R1에서 무선 스테이션 H1로 데이터그램 전송

1. 라우터의 동작:
   - 라우터는 목적지 IP 주소를 기반으로 H1의 MAC 주소를 ARP를 통해 획득한다.
   - 생성된 이더넷 프레임:
     - 출발지 주소: R1의 MAC 주소
     - 목적지 주소: H1의 MAC 주소

2. AP의 동작:
   - 이더넷 프레임을 수신하여 802.11 프레임으로 변환한다:
     - Address 1: H1의 MAC 주소
     - Address 2: AP의 MAC 주소
     - Address 3: R1의 MAC 주소

3. H1의 동작:
   - Address 3을 통해 데이터를 전송한 라우터의 MAC 주소를 확인할 수 있다.

#### 2️ 무선 스테이션 H1에서 라우터 인터페이스 R1로 응답 전송

1. H1의 동작:
   - 생성된 802.11 프레임:
     - Address 1: AP의 MAC 주소
     - Address 2: H1의 MAC 주소
     - Address 3: R1의 MAC 주소

2. AP의 동작:
   - 802.11 프레임을 수신하여 이더넷 프레임으로 변환한다:
     - 출발지 주소: H1의 MAC 주소
     - 목적지 주소: R1의 MAC 주소

3. 라우터의 동작:
   - Address 3 정보를 통해 목적지 MAC 주소를 결정한다.

---

### 4. Sequence Number, Duration, Frame Control 필드

#### Sequence Number

- 역할: 프레임의 순서를 나타내는 번호로, 수신자가 새로 전송된 프레임과 재전송된 프레임을 구분할 수 있게 한다.

#### Duration

- 역할: 데이터 프레임 전송 시간과 ACK 전송 시간을 포함한 채널 예약 시간을 나타낸다.
- 동작 방식: 이 값은 프레임의 Duration 필드에 포함되며, 네트워크 내에서 채널 충돌을 방지한다.

#### Frame Control

- 역할: 프레임의 성격과 동작을 제어하는 여러 서브필드를 포함한다.
  - Type/Subtype 필드: RTS, CTS, ACK, 데이터 프레임 등을 구분한다.
  - To/From 필드: 주소 필드의 의미를 정의한다.
  - WEB 필드: 암호화 사용 여부를 나타낸다.
- 동작 방식: 프레임의 동작 모드(애드혹 또는 인프라스트럭처 방식)와 전송 주체(AP 또는 무선 스테이션)에 따라 동작이 달라진다.

---

### 요약

802.11 프레임은 무선 환경에 특화된 데이터 전송 구조로, 각 필드가 네트워크 연동 및 데이터 안정성에 중요한 역할을 한다. 특히 주소 필드와 Frame Control 필드는 데이터 흐름을 관리하고 무선 네트워크의 신뢰성을 높이는 데 핵심적이다.

## 7.3.4 동일한 IP 서브넷 내에서의 이동성
무선 랜의 물리적 영역을 증가시키기 위해 동일한 IP 서브넷에 여러 개의 BSS를 설치하기도 한다.     
따라서 무선 스테이션이 기존 TCP 세션을 유지한 채로 어떻게 한 BSS에서 다른 BSS로 매끄럽게 이동할 수 있는가 하는 이동성 문제가 발생한다.

![image](https://github.com/user-attachments/assets/bc00a246-468f-463f-9a16-043af9202168)
### TCP 연결 유지:
TCP는 IP 주소 기반으로 연결을 관리하므로       
같은 서브넷 내에서는 H1의 IP 주소가 변경되지 않으므로, TCP 연결은 그대로 유지

1. 라우터는 관여하지 않음:
- 그림에 보이는 스위치 위에 라우터가 있다면, 이는 단순히 IP 계층의 상위 역할을 할 뿐, 동일한 서브넷 내에서의 이동에서는 관여하지 않는다.
- 여기서는 스위치와 AP 간의 동작만 다루며, TCP 연결도 IP 주소가 변하지 않으므로 그대로 유지.

### 스위치의 역할
- 스위치는 단순히 데이터 프레임(MAC 주소 기반)을 전달하는 역할을 합니다.
- AP가 바뀌어도 스위치는 H1의 MAC 주소가 어디에 있는지 학습(Self-Learning)하여 포워딩 테이블을 업데이트합니다.

### TCP 연결은 그대로 유지
- TCP 연결은 IP 주소 기반으로 동작하며, 여기서는 동일한 서브넷이기 때문에 IP 주소가 바뀌지 않는다.
- 따라서 TCP 연결은 끊기지 않고 계속 유지.
  
### AP 전환 과정
- H1이 BSS1(AP1)에서 BSS2(AP2)로 이동하면, AP2가 이를 스위치에 알린다(브로드캐스트).
- 이후 스위치는 H1의 MAC 주소가 AP2를 통해 연결되었음을 학습하고 데이터 프레임을 AP2로 전달.
비유:
- 이 상황을 마치 H1(노트북)이 다른 Wi-Fi 기지국(AP2)으로 이동하는 상황으로 보면 됨.
- 스위치는 어디에 데이터 프레임을 보내야 할지 새롭게 학습할 뿐, TCP/IP 수준의 연결에는 영향을 미치지 않음.


---

### 7.3.5 802.11의 고급 특징

#### 802.11 전송률 적응
802.11 네트워크에서는 신호 품질(SNR)이 상황에 따라 달라지기 때문에, 전송 속도에 영향을 주는 변조 기법을 유연하게 조정할 필요가 있다.

예를 들어:
- 한 사용자가 기지국에서 20m 떨어진 곳에 있다고 가정해보자. 이때 SNR이 높아 빠른 전송률로 데이터를 전송할 수 있다.
- 하지만 사용자가 기지국에서 멀어지기 시작하면 SNR이 낮아지면서 데이터 오류(BER)가 증가한다.

이를 해결하기 위해 전송률 적응(rate adaptation) 기능이 등장했다. 이 기능은 현재 신호 상태를 분석해 적합한 변조 기법을 자동으로 선택한다. 

비유:
마치 인터넷 속도가 느린 곳에서는 저화질 동영상으로 전환하고, 속도가 빠른 곳에서는 고화질 동영상을 자동 재생하는 것과 같다. 이렇게 환경에 맞춰 유연하게 대응하면 효율적으로 데이터를 전송할 수 있다.

---

#### 전력 제어
와이파이에서 배터리를 아끼기 위해, 노드는 자신이 활동 상태인지 잠자는 상태인지를 명확히 관리한다.

1. 수면 상태와 동작 상태:
   - 노드는 배터리를 아끼기 위해 수면 상태(sleep state)와 동작 상태(wake state)를 오간다.
   - 노드가 "이제 잠 좀 자볼게요!"라며 802.11 프레임의 전력 제어 비트를 1로 설정하면 AP가 이를 받아들인다.

2. 비컨 신호 활용:
   - AP는 수면 상태 노드로 데이터를 보내지 않고 대신 버퍼에 저장한다.
   - 노드는 비컨 신호가 전송되기 직전에 잠에서 깨어나 필요한 데이터를 요청한다.
   - 만약 데이터가 없다면, "아무 일 없네? 다시 잘래!"라며 바로 다시 수면 상태로 돌아간다.

비유:
이것은 알람 소리에 맞춰 잠깐 깨어나 스케줄을 확인하고 다시 자는 것과 비슷하다. 꼭 필요한 순간에만 깨어나서 에너지를 절약한다.

---

### 7.3.6 PAN(Personal Area Network): 블루투스

#### 블루투스 개요
블루투스는 짧은 거리(수십 미터)에서 저전력으로 동작하는 기술로, WPAN(Wireless Personal Area Network) 또는 피코넷(piconet)이라고도 한다.

예를 들어:
- 블루투스 이어폰은 바로 옆 스마트폰과 연결돼 음악을 재생한다. 굳이 먼 거리에서 강력한 신호를 쏘지 않아도 되므로 배터리를 아낄 수 있다.

특징:
- 시분할 다중화(TDM): 시간을 나눠 데이터를 전송
- 랜덤 백오프: 충돌을 피하기 위해 무작위 대기
- ACK/NAK: 데이터를 잘 받았는지 확인
- 저전력: 배터리를 효율적으로 사용

---

#### 주요 기술

1. 시분할 다중화(TDM):
   - 블루투스는 625μs(마이크로초) 시간 슬롯 단위로 동작한다.
   - 각각의 시간 슬롯마다 송신자는 79개 주파수 채널 중 하나를 사용하며, 슬롯마다 채널을 변경한다.
   - 채널 변경은 랜덤하게 이루어지며, 이는 간섭을 줄이는 데 효과적이다.

비유:
이것은 라디오 주파수를 계속 바꿔가며 방송을 듣는 것과 같다. 특정 주파수에서 잡음이 들려도 금방 다음 주파수로 이동하기 때문에 깨끗한 방송을 계속 들을 수 있다.

2. 애드혹 네트워크:
   - 블루투스 네트워크는 AP 없이 장치들끼리 스스로 네트워크를 구성한다.
   - 최대 8개의 활성 노드와 255개의 수면 상태 노드로 구성된다.
   - 수면 상태 노드는 정해진 시간에 깨어나 비컨 메시지를 확인하고 필요한 데이터를 교환한다.

예:
- 노트북, 블루투스 마우스, 블루투스 이어폰이 연결된 네트워크를 상상해보자. 이 장치들은 서로 인프라 없이도 자유롭게 통신한다.

---

#### 중앙 집중형 제어 노드 역할

블루투스 네트워크에서는 중앙 집중형 제어 노드가 모든 것을 관리한다.

1. 역할:
   - 시간 슬롯 관리
   - 주파수 변경 순서 제공
   - 클라이언트 장치 전송 전력 제어

2. 클라이언트 전송 제어:
   - 중앙 집중형 제어 노드는 폴링 방식(순서대로 요청)을 통해 각 장치에게 데이터를 보낼 권한을 부여한다.

비유:
이것은 한 명의 진행자가 토론 순서를 정리해 발언 기회를 주는 것과 비슷하다. 질서 있게 대화가 진행될 수 있다.

---

#### 네트워크 구성 절차

1. 이웃 탐색:
   - 중앙 집중형 제어 노드는 "여기 아무도 있나요?"라며 조회 메시지를 보낸다.
   - 근처에 있는 클라이언트가 응답하면 네트워크에 추가된다.

2. 블루투스 페이징(Bluetooth Paging):
   - 네트워크에 가입할 클라이언트는 초대 메시지를 받고, 이에 응답하면 연결이 이루어진다.
   - 이후, 중앙 집중형 제어 노드가 주파수 변경 정보를 전달해 클라이언트와 통신을 시작한다.

비유:
파티 주최자가 초대장을 보내고, 손님들이 초대에 응답해 파티에 참여하는 과정과 같다. 초대된 손님은 파티 규칙(주파수 변경)을 따르며 모두 함께 대화한다.


