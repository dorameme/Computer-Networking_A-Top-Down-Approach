## 3.2 다중화와 역다중화

### 네트워크 계층의 역할 (데이터를 호스트-호스트 사이 전달하는 역할)

1. **패킷 라우팅**: 네트워크 상의 경로를 결정하여 패킷을 목적지로 전달한다.
2. **주소 지정 및 패킷 전달**: IP 주소를 기반으로 데이터의 목적지를 설정한다.
3. **호스트 대 호스트 연결**: 서로 다른 네트워크에 위치한 호스트 간 데이터를 교환하도록 지원한다.

 **즉, 네트워크 계층은 ISP(인터넷 서비스 제공자)를 이용해 네트워크 간 데이터를 전달하는 역할을 한다.**

---

### 트랜스포트 계층의 역할 (데이터를 호스트에서 프로세스로 전달하는 역할)

#### 주요 역할:

1. **데이터 분리 및 전달** (다중화/역다중화): 세그먼트를 생성하여 데이터를 포트 번호를 기준으로 애플리케이션에 전달한다.
2. **신뢰성 제공 (TCP)**: 데이터 전송 신뢰성 보장, 순서 제어, 흐름 제어 등을 수행한다.
3. **단순 전송 (UDP)**: 빠르고 가벼운 데이터 전송을 수행하며, 별도의 연결 설정이나 신뢰성 보장을 제공하지 않는다.
4. **소켓 관리**: 소켓을 통해 프로세스와 통신하며, 각 소켓은 고유의 포트 번호로 식별된다.

 **즉, 트랜스포트 계층은 네트워크 계층으로 전달된 데이터를 소켓을 통해 프로세스에 적절히 분배하는 역할을 한다.**

---

### 트랜스포트 계층의 다중화와 역다중화의 쉬운 설명

- **다중화 (Multiplexing):** 여러 애플리케이션에서 데이터를 받아 세그먼트로 캡슐화하고 네트워크 계층으로 전달한다. 즉, 데이터를 송신하는 과정이다.

- **역다중화 (Demultiplexing):** 네트워크 계층에서 받은 데이터를 분석해 적절한 애플리케이션으로 전달한다. 즉, 데이터를 수신하는 과정이다.

---

### 연결지향형 다중화와 역다중화 (TCP)

#### 주요 특징

1. **연결 설정 필요**: TCP는 데이터를 전송하기 전에 연결을 설정(SYN-ACK 핸드셰이크)한다.
2. **환영 소켓**: TCP 서버는 클라이언트의 연결 요청을 처리하기 위해 환영 소켓을 사용한다. 이는 요청을 수락하고 클라이언트와의 통신을 위한 개별 소켓을 생성하는 역할을 한다.
3. **소켓 식별 요소**: 출발지 IP 주소, 출발지 포트 번호, 목적지 IP 주소, 목적지 포트 번호로 식별된다.
4. **신뢰성 보장**: 데이터 손실, 중복, 순서 변경을 방지하며 필요 시 재전송한다.
5. **오버헤드**: 추가 정보가 많아 헤더가 복잡하고 오버헤드가 크다.

#### TCP 웹 서버의 연결 처리
1. 기본 처리 방식: 웹 서버는 각 클라이언트 연결에 대해 새로운 소켓을 생성하여 HTTP 요청을 처리한다.
2. 프로세스 기반 처리: 과거에는 각 연결에 대해 새로운 프로세스를 생성하고, 이 프로세스가 연결 소켓을 통해 요청과 응답을 처리했다.
3. 스레드 기반 처리: 현대의 고성능 웹 서버는 하나의 프로세스만을 사용하며, 각 클라이언트 연결에 대해 새로운 스레드(thread)와 소켓을 생성하여 효율적으로 처리한다.

#### 동작 과정

1. 클라이언트와 서버 간 연결을 설정한다.
2. 데이터 전송 중 시퀀스 번호와 ACK 번호를 사용해 데이터의 순서와 정확성을 보장한다.
3. 데이터 전송 완료 후 연결을 종료한다.

---

### 비연결형 다중화와 역다중화 (UDP)

#### 주요 특징

1. **연결 설정 없음**: UDP는 연결 설정 없이 데이터를 전송한다.
2. **소켓 식별 요소**: 목적지 IP 주소와 목적지 포트 번호로 소켓을 식별한다.
3. **신뢰성 미보장**: 데이터 손실, 중복, 순서 변경 처리가 없으며 빠른 전송이 가능하다.
4. **오버헤드 낮음**: 헤더 구조가 단순해 오버헤드가 낮다.

#### 동작 과정

1. 데이터를 생성하고 헤더와 함께 전송한다.
2. 수신한 데이터를 목적지 포트 번호를 기준으로 소켓으로 전달한다.
3. 데이터 확인이나 재전송은 애플리케이션 계층에서 처리한다.

---

### 연결지향형 다중화와 비연결형 다중화 비교

| **특징**          | **연결지향형 (TCP)**                             | **비연결형 (UDP)**                          |
|-------------------|-------------------------------------------|---------------------------------------|
| **연결 방식**      | 연결형 (Connection-oriented), 연결 설정 및 종료 과정 필요 | 비연결형 (Connectionless), 연결 설정 및 종료 과정 없음 |
| **소켓 식별 요소** | 출발지 IP 주소, 출발지 포트 번호, 목적지 IP 주소, 목적지 포트 번호 | 목적지 IP 주소, 목적지 포트 번호                    |

---

### 트랜스포트 계층 다중화의 요구사항

1. 소켓은 유일한 식별자를 가져야 한다. (포트 번호)
2. 세그먼트에는 해당 세그먼트를 전달할 적절한 소켓을 식별하는 필드가 포함되어야 한다.
   - 출발지 포트 번호 필드 (source port number field)
   - 목적지 포트 번호 필드 (destination port number field)

#### 역다중화의 처리 과정

1. 각 소켓은 고유의 포트 번호를 할당받는다.
2. 세그먼트가 호스트에 도착하면 트랜스포트 계층은 목적지 포트 번호를 검사한다.
3. 세그먼트를 해당 포트 번호와 연결된 소켓으로 전달한다.
4. 세그먼트의 데이터는 소켓을 통해 해당 프로세스로 전달된다.

---

### Persistent HTTP와 Non-persistent HTTP

#### 지속적인(persistent) HTTP

클라이언트와 서버는 동일한 서버 소켓을 통해 여러 HTTP 메시지를 교환한다.

#### 비지속적인(non-persistent) HTTP

각 요청/응답마다 새로운 TCP 연결이 생성되고 종료된다.

