### 3.4 신뢰적인 데이터 전송의 원리

신뢰적인 데이터 전송을 구현하는 문제는 모든 계층의 프로토콜에서 공통적으로 발생하며, 데이터 손실과 손상을 방지하고 전송 순서를 보장하는 데 초점이 맞춰진다.

#### 3.4.1 신뢰적인 데이터 전송 프로토콜의 구축

##### 유한상태 머신(Finite-State Machine, FSM)

FSM은 상태 전이(event)와 행동(action)을 정의한다.    
신뢰적인 데이터 전송에서 각 상태에서 발생 가능한 이벤트와 그에 따른 행동을 명확히 구분함으로써 프로토콜의 동작을 체계적으로 설계할 수 있게 한다.



- 이벤트가 발생하면 전이하며 행동을 수행한다.
- 이벤트나 동작이 없는 경우 `Λ`로 표시한다.

###### rdt1.0 (완벽한 채널에서의 신뢰적인 데이터 전송)

- **송신자**: 상위 계층에서 데이터를 받아 패킷을 생성하고 전송.
- **수신자**: 패킷을 받아 데이터를 추출하고 상위 계층에 전달.
- 완벽한 채널이므로 오류나 피드백이 필요 없다.

###### rdt2.0 (비트 오류를 포함한 채널)

- **자동 재전송 요구(ARQ)**: 오류 검출, 수신자 피드백(ACK/NAK), 재전송 기능 추가.
- 송신자는 패킷을 전송하고, ACK/NAK에 따라 상태를 전이한다.
- 수신자는 패킷을 수신하고 오류 여부에 따라 ACK/NAK를 송신한다.
- 문제점: ACK/NAK 손상 시 송신자는 상태를 알 수 없다. 예를 들어, NAK가 손상되면 송신자는 수신자가 해당 패킷을 제대로 받았는지, 아니면 재전송이 필요한지 파악할 방법이 없다. 이로 인해 불필요한 패킷 재전송이나 데이터 손실의 가능성이 생긴다.

###### rdt2.1 (수정 버전: 순서 번호 추가)

- 송신자는 패킷에 순서 번호를 추가.
- 수신자는 중복 ACK를 송신하여 손상된 ACK/NAK 문제를 해결.

###### rdt2.2 (NAK 없는 프로토콜)

- NAK 대신 중복 ACK를 사용하여 수신자는 손상된 패킷을 처리.
- 송신자는 중복 ACK를 통해 재전송을 결정.

**NAK 없는 프로토콜이 필요한 이유**

1. **NAK 손실 문제 방지**:
   - NAK가 손상되거나 손실될 경우 송신자는 수신자의 상태를 알 수 없다.
   - NAK 없는 프로토콜은 중복 ACK를 활용하여 송신자가 손상된 패킷을 재전송하도록 한다.
2. **단순화된 설계**:
   - NAK 없는 프로토콜에서는 수신자가 부정 확인응답 대신 중복 ACK를 송신하므로, 설계가 단순해진다.
3. **성능 향상**:
   - 수신자는 중복 ACK를 통해 오류를 처리하며, 송신자는 이를 기반으로 재전송을 결정해 효율적이다.
4. **유연한 오류 처리**:
   - 중복 ACK는 손상된 패킷뿐만 아니라 순서 문제를 해결할 수 있어, NAK보다 유연하다.
5. **실제 네트워크 환경에서의 강건성**:
   - 실제 네트워크에서는 ACK와 NAK 모두 손실 가능성이 있지만, 중복 ACK를 활용하면 안정적인 동작이 가능하다.

###### rdt3.0 (비트 오류와 손실 포함)

- 패킷 손실 처리: 타이머를 통해 손실된 패킷 재전송.
- 얼터네이팅 비트 프로토콜: 순서 번호를 교대로 사용.
- 타임아웃 발생 시 가장 오래된 패킷을 재전송.

#### 3.4.2 파이프라이닝된 신뢰적인 데이터 전송 프로토콜

파이프라이닝은 송신자가 여러 패킷을 동시에 전송할 수 있도록 허용하여 성능을 향상시킨다.   
예를 들어, 전송 후 대기(stop-and-wait) 프로토콜에서는 한 패킷에 대해 ACK를 수신하기 전까지 다음 패킷을 전송할 수 없다.    
하지만 파이프라이닝에서는 다수의 패킷을 한꺼번에 전송하여 네트워크 대역폭을 최대한 활용한다. 이로 인해 고속 네트워크 환경에서 송신자 이용률이 크게 향상된다.

###### GBN (Go-Back-N)

- 확인응답되지 않은 패킷의 최대 허용 수(N)에 따라 동작.
- ACK 누적 확인 방식을 사용하며, 타임아웃 발생 시 모든 확인응답되지 않은 패킷을 재전송.
- 장점: 구현이 간단.
- 단점: 불필요한 재전송 발생 가능.
- 예를 들어, 순서 번호가 0에서 4까지인 5개의 패킷을 전송했을 때, 패킷 2가 손실되면 패킷 2 이후의 3, 4 패킷도 재전송해야 한다.     
 이는 채널이 오류가 적은 환경에서도 성능 저하를 초래할 수 있다.
 
###### SR (Selective Repeat)

- 손실된 패킷만 선택적으로 재전송.
- 수신자는 순서와 무관하게 패킷을 저장하고, 올바르게 수신된 패킷만 ACK 송신.
- 송신자는 각 패킷에 대해 개별 타이머를 사용.
- 장점: 불필요한 재전송 방지.
- 단점: 구현 복잡도 증가.
- 예를 들어, SR 프로토콜은 각 패킷에 대해 별도의 타이머를 관리해야 하므로 메모리와 처리 리소스의 소모가 크다.    
- 또한, 송신자와 수신자가 윈도 크기 및 상태를 정확히 동기화하지 못하면 데이터 손실 또는 중복 전송의 가능성이 증가한다.

#### 주요 메커니즘 요약

- **체크섬**: 비트 오류 검출.
- **타이머**: 패킷 손실 시 재전송.
- **순서 번호**: 중복 패킷 및 순서 보장.
- **확인응답(ACK)**: 올바르게 수신된 패킷 확인.
- **부정 확인응답(NAK)**: 잘못 수신된 패킷 요청.
- **윈도와 파이프라이닝**: 송신자 이용률 향상 및 네트워크 성능 최적화.

#### 결론

신뢰적인 데이터 전송 프로토콜은 네트워크 환경에 따라 다양한 요구사항을 충족해야 한다. 각 프로토콜은 성능, 구현 난이도, 오류 처리 방식의 균형을 고려하여 설계된다.

