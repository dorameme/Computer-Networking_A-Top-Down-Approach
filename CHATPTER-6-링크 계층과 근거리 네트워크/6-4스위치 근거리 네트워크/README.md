## 스위치 근거리 네트워크

스위치는 링크 계층에서 동작하기 때문에 링크 계층 프레임을 교환한다. 또한, 
네트워크 계층 주소(IP 주소)를 인식하지 않으며, OSPF 같은 라우팅 알고리즘을 사용하지 않는다. 
즉, 스위치는 IP 주소가 아닌 링크 계층 주소(MAC 주소)를 사용한다.

---

## 6.4.1 링크 계층 주소체계와 ARP

##### 네트워크 계층 주소와 링크 계층 주소

네트워크 계층 주소(IP 주소) 체계가 있음에도 링크 계층 주소(MAC 주소)를 사용하는 이유는 다음과 같다:

1. 랜(LAN)은 IP와 인터넷뿐만 아니라 다양한 네트워크 계층 프로토콜과의 호환성을 위해 설계되었다.
2. 어댑터가 MAC 주소 대신 네트워크 계층 주소를 사용한다면,\
   IP는 동적이므로 네트워크 계층 주소를 어댑터의 RAM에 저장해야 하며, 어댑터를 이동할 때마다 이를 재구성해야 한다.
3. 계층 독립성을 유지하려면 각 계층이 고유한 주소 체계를 가져야 한다.

비유하자면, MAC 주소는 컴퓨터의 고유 주민등록번호와 같으며, IP 주소는 현재 거주하는 주소와 같다. 컴퓨터가 이동하더라도 MAC 주소는 변하지 않지만, IP 주소는 새 네트워크에 연결되면 변경된다.

---

##### MAC 주소

###### MAC 주소란?

실제로 링크 계층 주소를 가진 것은 호스트나 라우터가 아니라, 호스트나 라우터의 어댑터(네트워크 인터페이스)이다.
따라서 다수의 네트워크 인터페이스를 갖고 있는 장비는 여러 개의 링크 계층 주소를 가질 수 있다.

반면, 링크 계층 스위치는 호스트와 라우터 간에 데이터그램을 전달하는 역할을 수행하기 때문에 자체적으로 링크 계층 주소를 할당받지 않는다.

###### MAC 주소 표기법

- MAC 주소는 6바이트(48비트) 길이의 링크 계층 주소이다.
- 2^48개의 사용 가능한 랜(LAN) 주소를 제공한다.
- 주로 각 바이트는 2개의 16진수로 표기된다. 예: `00-1A-2B-3C-4D-5E`

예시로, MAC 주소는 주민등록번호처럼 고유하며, IEEE가 MAC 주소 공간을 관리하여 모든 어댑터가 다른 주소를 갖도록 보장한다.

1. 어댑터 제조 회사는 2^24개의 주소로 이루어진 영역을 구매한다.
2. 구매한 영역의 첫 24비트를 고정하고, 나머지 24비트는 각 어댑터에게 고유하게 할당한다.

MAC 주소는 평면 구조를 가지며, 위치에 관계없이 동일하게 유지된다. 반면, IP 주소는 계층 구조를 가지며 네트워크 위치에 따라 변경된다.

###### MAC 주소는 평면적이고, IP 주소는 계층적이라는 의미

- MAC 주소의 평면 구조: MAC 주소는 네트워크 내 모든 장치가 고유한 값을 가지도록 설계된 단순한 구조이다. \
  이는 특정 네트워크 위치에 영향을 받지 않고, 어디에서나 동일하게 사용된다.

- IP 주소의 계층 구조: IP 주소는 네트워크와 서브네트워크를 식별하기 위한 계층적 구조를 가진다. \
  예를 들어, IP 주소 `192.168.1.1`은 대역폭을 정의하는 네트워크 부분(`192.168`)과 개별 호스트를 정의하는 호스트 부분(`1.1`)으로 구성된다. 이러한 계층 구조는 데이터의 전달 경로를 효율적으로 설정할 수 있도록 한다.

비유하자면, IP 주소는 우편주소처럼 국가, 도시, 구, 상세 주소로 계층적으로 나뉘어 있어 경로 설정이 용이하다. 반면, MAC 주소는 주민등록번호처럼 고유하지만 위치 정보는 포함하지 않는다.

###### MAC 주소의 활용

송신 어댑터는 프레임에 목적지 MAC 주소를 포함하여 랜에 전송한다. 스위치는 처음에는 프레임을 모든 포트로 브로드캐스트하며, 이후 학습 과정을 통해 경로를 최적화한다. 프레임을 수신한 어댑터는 다음 과정을 거친다:

1. 프레임 안의 목적지 MAC 주소와 자신의 MAC 주소가 일치하는지 검사한다.
2. 일치하면 데이터를 추출하여 프로토콜 스택의 상위 계층으로 전달한다.
3. 일치하지 않으면 해당 프레임을 폐기한다.

만약 모든 장치가 동일한 데이터를 수신해야 한다면, 송신 어댑터는 MAC 브로드캐스트 주소(6바이트의 모든 비트를 1로 설정한 주소, `FF:FF:FF:FF:FF:FF`)를 사용한다.

---
### ARP (Address Resolution Protocol)

ARP는 네트워크 계층 주소(IP 주소)와 링크 계층 주소(MAC 주소) 간의 변환을 담당하는 프로토콜이다. 각 네트워크 인터페이스에는 IP 주소와 MAC 주소가 있으며, ARP 모듈은 이러한 변환을 처리한다.

---

#### ARP의 역할과 작동 원리

네트워크에서 데이터를 전송하기 위해서는 IP 주소뿐만 아니라 목적지 MAC 주소가 필요하다. 예를 들어, A 호스트가 C 호스트로 데이터를 전송하려면 C의 IP 주소와 MAC 주소를 알아야 한다. ARP는 다음과 같은 과정을 통해 이를 해결한다:

1. 송신 호스트(A)는 ARP 요청을 통해 목적지 IP 주소에 해당하는 MAC 주소를 요청한다.
2. 동일한 서브넷의 모든 장치가 ARP 요청을 수신하고, 해당 IP 주소를 가진 장치만 MAC 주소를 응답한다.
3. 송신 호스트는 응답을 받은 MAC 주소를 ARP 테이블에 저장하여 이후에 재사용한다.

비유하자면, ARP는 네트워크 내부에서 IP 주소에 해당하는 "주소록"을 조회하는 과정과 유사하다.

---

#### ARP 테이블

각 호스트와 라우터는 ARP 테이블(ARP table)을 가지고 있다. ARP 테이블에는 IP 주소와 MAC 주소의 매핑 정보와 TTL(time-to-live) 값이 저장된다. TTL은 해당 정보가 테이블에 유지되는 기간(일반적으로 20분)을 나타낸다.

만약 ARP 테이블에 목적지 노드의 정보가 없다면, ARP 요청을 통해 MAC 주소를 얻어야 한다.

---

#### ARP의 동작 과정

1. ARP 요청 생성:

   - 송신 호스트는 목적지 IP 주소를 포함한 ARP 요청 패킷을 생성한다.
   - 요청 패킷은 브로드캐스트 프레임으로 서브넷의 모든 장치에 전송된다.

2. ARP 요청 수신:

   - 브로드캐스트된 ARP 요청은 서브넷 상의 모든 어댑터에 의해 수신된다.
   - 각 어댑터는 요청된 IP 주소가 자신의 IP 주소와 일치하는지 확인한다.

3. ARP 응답:

   - IP 주소가 일치하는 장치는 자신의 MAC 주소를 포함한 ARP 응답 패킷을 생성하여 송신 호스트로 전송한다.
   - ARP 응답은 브로드캐스트가 아닌 유니캐스트로 전송된다.

4. ARP 테이블 갱신:

   - 송신 호스트는 응답받은 MAC 주소를 ARP 테이블에 저장하여 이후 전송에 활용한다.

이 과정을 통해 ARP는 네트워크 계층(IP)과 링크 계층(MAC) 간의 매핑을 동적으로 관리한다.

---

#### 서브넷 외부 노드로의 데이터그램 전송

서브넷 외부의 노드로 데이터를 전송할 때는 라우터를 경유해야 한다. 예를 들어, 호스트 111.111.111.111이 호스트 222.222.222.222로 데이터를 전송하려는 경우 다음과 같은 절차가 이루어진다:

1. 송신 호스트는 목적지 IP 주소를 포함한 데이터그램을 생성한다.
2. 해당 데이터그램을 전송하기 위해 라우터 인터페이스의 MAC 주소를 ARP로 확인한다.
3. 확인된 MAC 주소와 함께 데이터그램을 송신한다.
4. 라우터는 자신의 포워딩 테이블을 참조하여 데이터그램을 다음 라우터나 목적지로 전달한다.
5. 최종적으로 목적지 서브넷의 MAC 주소를 ARP로 확인하여 데이터그램을 전달한다.

이처럼 ARP는 네트워크 계층과 링크 계층 간의 경계를 관리하며, 플러그 앤 플레이(plug-and-play) 방식으로 동작한다.      
(사용자가 별도의 설정이나 구성을 하지 않아도,  자동으로 쉽게 IP 주소랑 MAC 주소를 매핑해준다는 뜻)

---

#### DNS와 ARP의 공통점과 차이점

| 항목       | DNS                                                                 | ARP                                                                 |
|----------------|------------------------------------------------------------------------|------------------------------------------------------------------------|
| 역할       | 호스트 이름을 IP 주소로 변환                                           | IP 주소를 MAC 주소로 변환                                              |
| 동작 범위   | 인터넷 전반 (글로벌)                                                  | 동일한 서브넷 (로컬)                                                   |
| 프로토콜 계층 | 애플리케이션 계층                                                     | 네트워크와 링크 계층 사이                                               |
| 요청 방식   | 도메인 이름을 입력하면 서버에 쿼리                                     | IP 주소를 입력하면 브로드캐스트 요청                                    |
| 응답 방식   | DNS 서버로부터 유니캐스트로 응답                                      | 동일 서브넷 내에서 유니캐스트로 응답                                    |
| 주요 사용 예 | 웹사이트 접속 시 도메인 네임 변환                                      | 네트워크 내부 장치 간 데이터 전송 시 MAC 주소 확인                     |
| 관리 방식   | 중앙화된 DNS 서버에 의해 관리                                          | 각 장치의 ARP 테이블에 의해 자동으로 관리                              |
| 비유       | 전 세계적인 전화번호부                                                 | 지역 내의 주소록                                                      |

---

## 6.4.2 이더넷

오늘날 이더넷은 가장 우세한 랜(LAN) 기술이다. 인터넷이 글로벌 네트워킹을 담당한다면, 이더넷은 근거리 네트워킹을 위한 기술이다.

#### 이더넷 프레임 구조

![Image](https://github.com/user-attachments/assets/b89e5951-e4c8-4636-9c2d-7f386faf0f42)
1. 데이터 필드 (46\~1500바이트): IP 데이터그램을 운반하며, 1500바이트를 초과하면 단편화가 필요하고, 46바이트 미만이면 패딩으로 채움.
2. 목적지 주소 (6바이트): 목적지 MAC 주소.
3. 출발지 주소 (6바이트): 출발지 MAC 주소.
4. 타입 필드 (2바이트): 네트워크 계층 프로토콜을 다중화할 수 있도록 허용.
5. 순환 중복 검사(CRC) (4바이트): 프레임의 오류 검출을 지원.
6. 프리앰블 (8바이트):      
- 프리앰블(Preamble)은 네트워크 통신에서 데이터 프레임의 시작 부분에 위치한 필드로, 주요 목적은 수신 장치와 송신 장치 간의 동기화를 제공하는 것이다. 
- 쉽게 말해, "데이터가 시작될 테니 준비하세요!"라고 알려주는 역할

동기화(Synchronization): 데이터 전송 전에 수신 장치가 송신 장치의 신호를 정확히 감지하고 준비할 수 있도록 클럭 신호를 동기화한다.

프레임 시작 표시(Frame Delimiter): 데이터 프레임의 시작을 표시하여 수신 장치가 데이터의 경계를 정확히 인식하게 한다.
   - 첫 7바이트는 10101010, 마지막 바이트는 10101011로 구성.
   - 수신 어댑터의 클록을 송신 어댑터와 동기화.

---
## 이더넷의 비연결형 및 비신뢰적인 서비스

### 1. 비연결형 서비스
- 핸드셰이킹 없이 데이터 전송  
  송신 어댑터(데이터를 보내는 장치)는 데이터를 네트워크로 전송하기 전에 수신자와 통신 상태를 확인하거나 연결을 설정하지 않는다.  
---

### 2. 비신뢰적인 서비스
- 오류 검사는 하지만 오류 응답 없음  
  수신 어댑터(데이터를 받는 장치)는 데이터를 받으면 오류를 검사(CRC 검사)하지만, 오류가 있으면 데이터를 폐기하고 송신자에게 알리지 않는다.  
  → 예를 들어, 우편물이 찢어진 상태로 도착했을 때, 수신자가 발송자에게 "다시 보내달라"고 요청하지 않고 그냥 버리는 것과 같다.  

- 결과  
  데이터가 잘 도착하지 않거나 오류가 발생해도 송신자는 이를 알 수 없으며, 데이터를 재전송할 수도 없다.

---

### 3. 데이터그램 손실 처리
이러한 이유로, 데이터 손실이나 오류 발생은 애플리케이션 계층에서 사용하는 전송 프로토콜(TCP, UDP)에 따라 다르게 처리된다.

#### 3.1 UDP (User Datagram Protocol)  
- UDP는 단순히 데이터를 보낼 뿐, 수신 여부나 오류를 확인하지 않는다.  
  → "데이터가 도착했는지 알 수 없다."  
  예: 스트리밍 서비스(동영상, 음성 통화)  
  - 데이터 몇 개가 손실되더라도 사용자에게 큰 영향을 미치지 않는다.
  - 대신 속도가 빠르고 효율적이다.

#### 3.2 TCP (Transmission Control Protocol)  
- TCP는 데이터를 보내면 수신자로부터 확인 응답(ACK)을 받고, 데이터가 손실되면 재전송한다.  
  → "데이터가 도착하지 않으면 다시 보내 정확히 전달한다."  
  예: 파일 전송, 이메일  
  - 데이터의 정확성과 신뢰성이 중요할 때 사용된다.

### 정리
이더넷은 데이터를 효율적으로 빠르게 전송할 수 있지만, 데이터 손실이나 오류 복구는 애플리케이션 계층(UDP, TCP)에서 처리하도록 설계된 구조이다.  
따라서 사용자가 어떤 서비스(실시간 통신, 파일 전송 등)를 구현하느냐에 따라 UDP나 TCP를 선택하여 데이터를 처리하게 된다.

---

#### 이더넷 기술의 발전

1. 1980년대:

   - 동축 버스를 사용하여 노드를 연결.
   - 버스 토폴로지의 브로드캐스트 랜으로, 전송된 모든 프레임은 버스에 연결된 모든 어댑터를 거치며 처리됨.

2. 1990년대:

   - 허브 기반의 스타 토폴로지로 전환.
   - 꼬임쌍선을 사용해 허브에 직접 연결.
   - 허브는 물리 계층 장치로, 비트를 수신하여 모든 포트로 복사해 전송함.

3. 2000년대 초반:

   - 허브가 스위치로 대체.
   - 스위치는 충돌 없는 저장-후-전달(store-and-forward) 패킷 스위치를 제공함.
   - 초기 브로드캐스트 링크에서 CSMA/CD(충돌 감지) 프로토콜을 사용했으나, 스위치 기반 토폴로지에서는 충돌이 없어 MAC 프로토콜이 필요하지 않음.
---

#### 허브와 스위치의 특징 및 차이

허브와 스위치는 랜(LAN) 네트워크에서 데이터를 전송하는 장치로, 동작 방식과 효율성에서 차이가 있다. 아래는 두 장치의 특징과 차이를 정리한 표이다:

| 항목        | 허브(Hub)          | 스위치(Switch)                 |
| ------------- | -------------------- | ------------------------------- |
| 동작 계층     | 물리 계층(1계층)           | 데이터 링크 계층(2계층)                  |
| 데이터 처리 방식 | 수신된 데이터를 모든 포트로 전송   | 목적지 MAC 주소를 기반으로 특정 포트로만 데이터 전송 |
| 브로드캐스트 방식 | 모든 연결된 장치로 데이터를 전송   | 필요한 장치로만 데이터를 전송하여 대역폭 낭비 감소    |
| 충돌 처리     | 충돌 발생 가능(CSMA/CD 필요) | 충돌 없음                           |
| 대역폭 활용    | 모든 포트가 공유 대역폭 사용     | 각 포트가 독립적으로 대역폭 사용              |
| 성능        | 낮은 성능                | 높은 성능                           |
| 비용        | 비용이 저렴               | 비용이 더 비싸지만 효율적                  |
| 구조        | 단순한 구조               | 복잡하지만 스마트한 데이터 처리 가능            |
| 주요 사용 시기  | 1990년대 초반            | 2000년대 이후                       |

#### 왜 스위치는 충돌이 없을까?

- 스위치는 각 포트가 독립된 통신 경로를 가지며, 데이터 프레임을 목적지 MAC 주소에 따라 특정 포트로만 전송한다.
- 이로 인해 서로 다른 포트 간의 데이터 전송이 독립적으로 이루어지며, 충돌이 발생하지 않는다.
- 반면, 허브는 데이터를 모든 포트로 브로드캐스트하기 때문에 여러 장치가 동시에 데이터를 전송하면 충돌이 발생할 가능성이 크다.       
 이를 해결하기 위해 허브는 CSMA/CD(Carrier Sense Multiple Access with Collision Detection) 프로토콜을 사용하여 충돌을 감지하고 해결한다.

#### 스위치는 FDM/TDM을 사용해 독립적인 대역폭을 제공하나?

- 스위치는 FDM(주파수 분할 다중화)나 TDM(시간 분할 다중화) 방식을 사용하지 않는다. 대신, 패킷 스위칭 방식을 활용한다.
- 각 포트는 독립적인 통신 채널로 작동하며, 데이터 프레임을 목적지에 따라 효율적으로 전달한다.
- 스위치 내부는 고속 백플레인(Backplane)을 사용하여 동시에 여러 데이터 전송을 처리할 수 있도록 설계되어 있다. 이를 통해 포트 간 대역폭이 독립적으로 유지된다.

---

#### MAC 프로토콜이란? 종류?

- MAC(Media Access Control) 프로토콜은 네트워크 매체를 공유하는 여러 장치 간 데이터 충돌을 방지하고 효율적인 데이터 전송을 보장하기 위해 설계된 규칙이다.
- 주로 데이터 링크 계층(2계층)에서 동작하며, 대표적인 MAC 프로토콜에는 다음이 포함된다:
  1. CSMA/CD (Collision Detection): 유선 LAN에서 충돌을 감지하고 해결하기 위한 프로토콜.
  2. CSMA/CA (Collision Avoidance): 무선 LAN(Wi-Fi)에서 충돌을 방지하기 위한 프로토콜.
  3. 알로하 (Aloha): 초기 무선 네트워크에서 사용된 단순한 충돌 관리 프로토콜.

---

#### CSMA/CD가 필요 없는 이유

- 스위치 기반 네트워크와 전이중 통신(Full Duplex) 방식의 등장으로, 데이터 충돌이 발생하지 않는 환경이 만들어졌기 때문이다.
- 각 포트가 독립적인 경로를 가지며, 특정 장치로만 데이터를 전달하므로 충돌 자체가 발생하지 않는다.
- 반면, 허브 기반 네트워크에서는 공유 매체를 사용했기 때문에 CSMA/CD가 필수적이었다.

---

#### 알로하나 다른 다중접속 링크 프로토콜은 현재 사용되지 않나?

- 대부분의 유선 네트워크에서는 스위치 기반 구조로 인해 알로하나 CSMA/CD 같은 다중접속 링크 프로토콜이 더 이상 사용되지 않는다.
- 그러나, 무선 네트워크(Wi-Fi)와 같이 공유 매체를 사용하는 환경에서는 CSMA/CA와 같은 충돌 회피 프로토콜이 여전히 필요하다.
- 특정 환경(위성 통신, IoT 등)에서는 알로하 기반의 변형 프로토콜이 사용되기도 한다.

---

#### CSMA/CD나 다중접속 링크 프로토콜을 배우는 이유

1. 네트워크 원리 이해:

   - CSMA/CD와 같은 프로토콜은 네트워크 충돌 문제를 해결하기 위한 초기 접근 방식으로, 네트워크 기술의 발전 과정을 이해하는 데 도움을 준다.

2. 현대 기술 응용:

   - CSMA/CA는 Wi-Fi 등 무선 네트워크에서 여전히 사용되므로 관련 개념이 중요하다.

3. 기술적 비교와 설계:

   - FDM, TDM, 패킷 스위칭 등 다양한 기술과 비교해 적합한 네트워크 설계를 결정할 수 있다.

4. 문제 해결 능력 강화:

   - 과거 기술을 이해하면 현재 네트워크 환경에서 발생하는 문제를 더 쉽게 분석하고 해결할 수 있다.

---

#### 공통점

- 목적: 허브와 스위치 모두 네트워크 장치 간의 데이터를 전달하는 역할을 수행한다.
- LAN에서 사용: 둘 다 근거리 네트워크(LAN) 환경에서 주로 사용된다.
- 유선 연결: 주로 유선 연결을 기반으로 장치를 네트워크에 연결한다.

#### 차이점 요약

- 허브는 모든 포트로 데이터를 브로드캐스트하지만, 스위치는 필요한 장치로만 데이터를 전송하여 네트워크 효율성을 높인다.
- 허브는 물리 계층에서 동작하고 충돌이 발생할 가능성이 높지만, 스위치는 데이터 링크 계층에서 동작하며 충돌을 방지한다.

----

### 6.4.3 링크 계층 스위치

#### 스위치의 역할

1. 스위치는 들어오는 링크 계층 프레임을 수신하여 적절한 출력 링크로 전달하는 역할을 한다.&#x20;
2. 스위치는 서브넷 내의 호스트와 라우터에게 투명하게 작동한다. \
   즉, 호스트와 라우터는 프레임이 스위치를 통해 전달되고 있다는 사실을 인식하지 못한다.
3. 프레임이 출력 인터페이스로 도달하는 속도가 인터페이스의 링크 용량을 초과할 수 있기 때문에, 스위치의 출력 인터페이스에는 이를 해결하기 위한 버퍼가 존재한다.

---

### 포워딩과 필터링

#### 1. 필터링 (Filtering)

- 프레임을 특정 인터페이스로 전달할지 폐기할지를 결정하는 기능이다.
- 스위치 테이블(switch table)을 사용하여 판단한다.

#### 2. 포워딩 (Forwarding)

- 프레임의 목적지에 따라 전송할 인터페이스를 결정하고 해당 인터페이스로 프레임을 전달하는 기능이다.
- 마찬가지로 스위치 테이블을 활용한다.

#### 스위치 테이블 구성 요소

1. MAC 주소: 특정 호스트/라우터의 주소
2. MAC 주소와 연결된 스위치 인터페이스
3. 해당 엔트리가 생성된 시점

#### 스위치 테이블의 동작 원리

- 테이블에 목적지 주소가 없는 경우:

  - 스위치는 프레임의 복사본을 모든 인터페이스(프레임이 수신된 인터페이스 제외)의 출력 버퍼로 전달한다. 이를 브로드캐스트(broadcast)라고 한다.

- 테이블에 목적지 주소가 수신된 인터페이스와 동일하게 매핑된 경우:

  - 프레임은 이미 송신자와 동일한 네트워크에 있기 때문에 다른 인터페이스로 전달할 필요가 없다. 따라서 프레임을 제거하여 네트워크 자원을 절약하고 불필요한 트래픽을 줄인다.

- 테이블에 목적지 주소가 다른 인터페이스와 매핑된 경우:

  - 프레임은 해당 인터페이스로 전달되어야 하며, 포워딩 기능이 수행된다.

---

### 자가학습 (Self-Learning)

스위치는 테이블을 자동으로, 동적으로, 자치적으로 구성하는 자가학습 기능을 가지고 있다.

#### 자가학습의 동작 과정

1. 스위치 테이블은 초기에는 비어 있다.
2. 각 프레임이 수신될 때, 스위치는 다음 정보를 저장한다:
   - 프레임의 출발지 MAC 주소
   - 프레임이 도착한 인터페이스
   - 프레임 수신 시점의 시간
3. 랜에 있는 모든 호스트가 프레임을 송신하면, 결국 모든 호스트에 대한 정보가 테이블에 기록된다.
4. 수명 시간(aging time)이 지난 후에 해당 주소는 테이블에서 삭제된다.
5. 스위치는 네트워크 관리자나 사용자의 개입 없이 동작하는 플러그 앤 플레이 장치(plug-and-play device)다.

---

### 링크 계층 스위치의 특성

#### 1. 충돌 제거

- 스위치로 구성된 랜에서는 충돌로 인해 대역폭이 낭비되지 않는다.
- 프레임을 버퍼링하여, 특정 시점에 세그먼트에 하나 이상의 프레임이 전송되지 않도록 한다.
- 브로드캐스트 링크 기반 랜보다 성능이 뛰어나다.

#### 2. 이질적인 링크

- 링크를 독립적으로 분리하여, 각 링크가 다른 속도나 매체를 사용할 수 있다.

#### 3. 관리

- 스위치는 보안을 강화하고 네트워크 관리를 쉽게 해준다.
  - 예: 케이블이 끊긴 경우, 해당 호스트의 연결만 단절된다.
  - 오작동을 감지하여 문제를 일으키는 어댑터의 연결을 끊는다.
  - 대역폭 사용, 충돌률, 트래픽 통계 등을 수집하여 제공한다.

---

### 보안 초점

#### 스위치 테이블 엔트리가 있을 때

- 호스트는 자신을 목적지로 하는 프레임만 수신하며, 다른 호스트의 프레임을 볼 수 없다.

#### 스위치 테이블 엔트리가 없을 때

- 스위치가 프레임을 브로드캐스트하므로, 스니퍼(sniffer)가 자신을 목적지로 하지 않는 일부 프레임을 볼 수 있다.
- 스위치 독(Switch Poisoning): 다수의 가짜 MAC 주소를 포함한 패킷을 전송하여 스위치 테이블을 가득 채우고, 합법적인 엔트리를 추가할 공간을 없앤다.

---

### 스위치 vs 라우터

| 구분    | 스위치                          | 라우터                         |
| ----- | ---------------------------- | --------------------------- |
| 사용 계층 | 데이터 링크 계층(2계층)               | 네트워크 계층(3계층)                |
| 주소 체계 | MAC 주소                       | IP 주소                       |
| 기능    | 저장 후 전달 방식으로 MAC 주소 기반 패킷 전달 | 저장 후 전달 방식으로 IP 주소 기반 패킷 전달 |
| 특징    | 플러그 앤 플레이 장치, 빠른 처리 속도       | 계층 구조 기반으로 최적 경로 제공         |

#### 라우터의 장점

- 계층 구조로 인해 중복 경로가 있더라도 패킷 순환이 없다.
- 스패닝 트리로 제한되지 않으며, 최적의 경로를 선택할 수 있다.
- 브로드캐스트 폭주에 대한 방화벽 보호 기능이 있다.

#### 라우터의 단점

- 플러그 앤 플레이 장치가 아니다. \
  이는 라우터를 설치하거나 설정할 때 네트워크 관리자나 사용자의 수동적인 개입이 필요함을 의미한다. \
  예를 들어, IP 주소와 라우팅 테이블을 수동으로 설정해야 하며, 네트워크 구성 변경 시 추가적인 작업이 요구된다.
- 스위치보다 패킷당 처리 시간이 더 길다.

#### 스위치의 장점

- 관리자의 개입이 적다.
- 높은 필터링 및 전달률을 제공한다.

#### 스위치의 단점

- 브로드캐스트 프레임 순환 방지를 위해 토폴로지가 스패닝 트리로 제한된다.
- 대규모 네트워크에서는 ARP 트래픽이 증가하고, ARP 테이블이 커진다.
- 브로드캐스트 트래픽 폭주에 대비한 방안을 제공하지 않는다.

---

### 요약

- 스위치는 링크 계층에서 MAC 주소 기반의 패킷 전달을 수행하며, 플러그 앤 플레이 특성과 자가학습 기능을 통해 효율적으로 작동한다.
- 라우터는 네트워크 계층에서 IP 주소 기반으로 패킷 전달을 수행하며, 복잡한 네트워크 환경에서 최적 경로를 제공한다.
- 각각의 장단점을 이해하고 네트워크 규모와 목적에 맞는 장치를 선택하는 것이 중요하다.

---


## 6.4.4 가상 근거리 네트워크 (VLAN)

#### LAN, VLAN, VLAN 트렁킹 비교 표 (LAN 계층 구조 포함)

| 항목         | LAN                       | VLAN                         | VLAN 트렁킹                   |
| ---------- | ------------------------- | ---------------------------- | -------------------------- |
| 정의         | 물리적 네트워크로 연결된 컴퓨터와 장치의 집합 | 하나의 물리적 네트워크를 여러 가상 네트워크로 나눔 | 여러 VLAN 간 트래픽을 하나의 링크로 연결  |
| 트래픽 격리     | 없음                        | VLAN 간 트래픽 격리 가능             | 여러 VLAN 간 트래픽 전달 가능        |
| 구성 방식      | 물리적 연결 기반                 | 논리적 그룹 기반                    | 트렁크 포트를 통해 연결              |
| 설정 복잡성     | 낮음                        | 중간                           | 높음                         |
| 확장성        | 제한적                       | 높음                           | 매우 높음                      |
| 적용 예시      | 소규모 네트워크                  | 대규모 조직, 부서 간 네트워크            | 다수의 VLAN이 연결된 네트워크         |
| 주요 특징      | 단순하고 직관적                  | 그룹 간 효율적 트래픽 관리              | VLAN 식별을 위해 확장된 이더넷 프레임 사용 |
| 필요한 장비     | 스위치                       | VLAN 지원 스위치                  | VLAN 트렁킹 지원 스위치와 라우터       |
| 브로드캐스트 도메인 | 전체 네트워크가 하나               | VLAN별로 별도                    | VLAN별로 별도                  |

---

#### LAN 계층 구조와 VLAN의 필요성

LAN은 물리적으로 연결된 네트워크 장치들이 단순히 동일한 네트워크 내에서 통신하는 구조를 제공한다. \
일반적으로 소규모 네트워크에서는 스위치가 계층적으로 구성되지 않아도 충분하다. \
그러나 대규모 네트워크에서는 트래픽 분산과 관리 효율성을 위해 계층적 스위치 구성을 사용하는 경우가 많다.

스위치가 계층적으로 구성된 기존 구조는 다음과 같은 문제를 가진다:

1. 트래픽 격리 부족

   - 기존 구조는 모든 그룹이 하나의 공간에서 신호를 주고받는 상황과 같다. 필요한 그룹 간 통신만 허용하지 못하고 전체 네트워크로 신호가 확산된다.
   - 이를 해결하려면 신호가 필요한 그룹에만 전달되도록 제한해 네트워크 성능을 높여야 한다.

2. 스위치 자원의 비효율적인 사용

   - 그룹별로 각각 별도의 스위치를 사용하는 것은 마치 작은 회의실을 여러 개 비워두는 것과 같다.
   - 실제로는 큰 회의실 하나를 적절히 나누어 사용할 수 있음에도, 기존 방식은 자원을 비효율적으로 사용한다.

3. 복잡한 사용자 관리

   - 사용자가 그룹을 이동할 때마다 새로운 케이블 연결 작업이 필요하다. 이는 물리적으로 이동을 반복해야 하는 비효율적인 구조와 같다.

이러한 단점을 가상 근거리 네트워크(VLAN)를 지원하는 스위치를 사용하여 해결할 수 있다.

---

#### VLAN의 정의와 특징

- VLAN은 하나의 물리적 네트워크 인프라에서 여러 개의 가상 네트워크를 정의할 수 있게 해준다.
- VLAN에 속한 호스트는 같은 VLAN에 속한 다른 호스트와만 통신할 수 있다.
- VLAN 스위치의 포트 기반 VLAN에서는 네트워크 관리자가 스위치 포트를 그룹으로 나누어 VLAN을 구성한다.
- 한 VLAN에 속한 포트들은 하나의 브로드캐스트 도메인을 형성한다.
  - 같은 그룹의 포트 간에만 브로드캐스트 트래픽이 전달된다.

---

#### VLAN 간 트래픽 전송

- 같은 VLAN 간 트래픽은 스위치 내부에서 직접 처리된다.
- 다른 VLAN 간 트래픽은 스위치만으로 처리할 수 없으며, 라우터를 거쳐야 한다.
  - VLAN 스위치의 포트를 외부 라우터와 연결한다.
  - 데이터그램은 한 VLAN에서 라우터를 통해 다른 VLAN으로 전달된다.
  - 스위치 제조사들은 VLAN 스위치와 라우터를 통합하여 관리 효율성을 높인 장비를 제공한다.

---

#### VLAN 확장과 트렁킹

- 외부 스위치와의 연결

  - 외부 스위치도 VLAN에 연결하려면 각각의 VLAN에 대해 별도의 포트를 사용해야 한다.
  - N개의 VLAN이 있는 경우 N개의 포트가 필요하므로 확장성이 떨어진다.

- VLAN 트렁킹 (VLAN Trunking)

  - VLAN 트렁킹은 여러 VLAN을 하나의 트렁크 포트로 연결하여 확장성을 제공한다.
  - 트렁크 포트는 모든 VLAN에 속하며, VLAN 간 트래픽을 트렁크 링크를 통해 다른 스위치로 전달한다.
  - 문제점: 어떤 트렁크 포트로 전달된 프레임이 어느 VLAN에 속하는지 알 수 없다.

---

#### VLAN 태그와 트렁크 포트

- IEEE VLAN 태그

  - IEEE는 VLAN 트렁크를 통과하는 프레임을 위한 확장된 이더넷 프레임 형식을 정의했다.
  - 이 확장된 프레임은 VLAN을 식별하기 위한 4바이트 VLAN 태그(VLAN Tag)를 포함한다.

- VLAN 태그의 구성

  1. 2바이트 태그 프로토콜 식별자(Tag Protocol Identifier, TPID)
  2. 2바이트 태그 제어 정보(Tag Control Information)
     - 12비트 VLAN 식별자
     - 3비트 우선순위(priority) 필드

- 송신 측 스위치에서 VLAN 태그가 추가되고, 수신 측 스위치에서 이를 제거한다.

---

#### VLAN의 장점

1. 트래픽 격리

   - 동일한 물리적 네트워크 인프라에서도 각 VLAN 간 트래픽이 격리된다.

2. 효율적인 리소스 사용

   - 여러 그룹을 단일 스위치로 관리할 수 있다.

3. 유연한 관리

   - 사용자가 그룹을 이동하더라도 물리적 네트워크 변경이 필요 없다.

4. 확장성

   - VLAN 트렁킹을 통해 네트워크를 쉽게 확장할 수 있다.

---

#### VLAN의 단점

1. 설정 복잡성

   - 네트워크 관리자가 VLAN 구성을 직접 설정해야 하므로 초기 설정이 복잡할 수 있다.

2. 라우팅 필요

   - VLAN 간 트래픽 전송을 위해 추가적인 라우터나 라우팅 기능이 필요하다.

3. 확장성 한계

   - VLAN 태그를 위한 식별자가 12비트로 제한되어 있어 최대 4096개의 VLAN만 지원할 수 있다.

---

### 요약

VLAN은 하나의 물리적 네트워크 인프라에서 여러 가상 네트워크를 구성하여 트래픽을 격리하고, 네트워크 자원의 효율적인 사용을 가능하게 한다. VLAN 트렁킹과 태그를 통해 확장성을 제공하며, 네트워크 관리의 유연성을 높인다. 그러나 설정의 복잡성과 라우팅 필요성, 확장성 한계는 VLAN 도입 시 고려해야 할 요소이다.



