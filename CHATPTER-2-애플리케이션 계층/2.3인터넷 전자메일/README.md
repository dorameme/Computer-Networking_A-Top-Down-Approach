# 인터넷 전자메일

- 이 절에서는 인터넷 전자메일 구조의 중심에 있는 애플리케이션 계층 프로토콜에 대해 알아본다.   
-     인터넷 전자메일의 주요 요소는 
      1.사용자 에이전트 2.메일 서버 3.SMTP 
- 메일 서버안에 각 수신자는 메일박스를 가지고 있다. 이를 통해 메세지를 유지하고 관리한다.

  ## 2.3.1 SMTP(simple mail transfer protocol)
  - 애플리케이션 계층 프로토콜이다.
  - TCP 의 신뢰적 데이터 전송을 이용한다.
  - SMTP는 송신자 메일 서버에서 수행하는 클라이언트, 수신자 메일 서버에서 수행되는 서버를 가지고 있다.
  - 메일을 보내면 클라이언트, 받으면 서버 (한 호스트는 둘다의 역할을 한다.)
  - SMTP는 HTTP 보다 오래된 프로토콜로 낡은 특성을 가진 오래된 기술이다.
  - 모든 메일은 7-bit ASCII로 제한되므로 크기가 큰 멀티미디어 전송에 어렵다. (또한 매번 데이터를 ASCII로 변환하는 오버헤드가 있음)
  - 중간 메일서버를 사용하지 않는다. 서버사이 직접연결을 한다.   
     따라서 전송실패시 어디 중간에 있는게 아니라 수신자의 메일서버에서 재시도.
  - 점(.)으로 된 라안을 송신하며 그것이 메세지의 끝을 나타낸다.
  - TCP지속연결을 통해 보낼 메세지가 여러개라도 하나의 연결을 통해 전달이 가능하다.
 -        SMTP는 초창기에는 직접 연결 방식을 사용했으나, 현재는 중계 서버(릴레이 서버)를 거치는 방식으로 발전하였다.     
        이러한 변화는 안정성, 보안, 확장성을 강화하기 위한 진화 과정이며, 현대의 이메일 시스템에서는 중계 서버 없이는 메일 전송이 거의 불가능하다.
  ## 2.3.2 HTTP 와의 비교
  SMTP HTTP
  -       공통점  
            1. 둘다 한 호스트에서 다른 호스트로의 파일전송 프로토콜이다.
            2. 파일전송시 지속HTTP, SMTP 모두 지속연결을 이용한다.
            3. 송신서버(클라이언트)가 먼저 TCP연결을 한다.
  -       차이점 
            1. HTTP 는 PULL프로토콜이라서 누군가 올린 정보를 가져오기위해 사용되는 프로토콜이다.
               SMTP 는 PUSH프로토콜이라서 송신서버가 수신서버에 파일을 보내기위해 사용되는 프로토콜이다.
            2. SMTP는 ASCII포멧을 요구하고 이진데이터(이미지파일)을 포함하면 ASCII포멧으로 인코딩이 필요하다.
               반면 HTTP는 이러한 제한이 없다.
            3. 텍스트와 이미지로 구성된 문서를 다룰떄 HTTP는 응답메세지에 각 객체를 캡슐화하고 SMTP는 모든 객체를 하나의 메세지로 만든다.
## 2.3.3 메일 메세지 포맷
- 헤더랑 바디로 되어있으며 헤더는 무조건 FROM 헤더라인과 TO 헤더라인을 가져야한다. 그다음 몸체에 ASCII코드가 온다.
----
## 2.3.4 메일 접속 프로토콜
 - 오늘날의 메일접속 프로토콜은 클라이언트-서버 구조를 사용한다. 
 SMTP방식은 메일서버가 클라이언트와 서버 모든 역할을 수행한다.
 하지만 이러한 상황은 클라이언트도 매일 메일수신을 위해 켜져있어 인터넷에 연결되어 있어야 한다는 문제가 있다.
 대신 일반적 사용자의 로컬PC에서 사용자 에이전트를 수행하고 공유메일서버에서 메세지를 수신관리한다.
 메일서버는 사용자들 끼리 공유하며 전형적으로 사용자의 ISP들이 유지관리한다.
 IMAP, POP3 , 앞의 두개대신 요즘엔 웹기반 전자메일 웹브라우저를 이용(HTTP)
- 전자메일 메세지는 SMTP 대신에 HTTP 가 이용되며 브라우저에서 메일서버로 전달된다.    
하지만 메일서버는 여전히 SMTP를 이용해 다른메일서버로 수신/송신을 한다.

---
## 오늘날의 이메일 프로토콜 동작 방식
-      메일 발송 시:    
      SMTP를 사용하여 발신 서버에 메일 전송 → 수신자의 메일 서버로 전달.    
-      메일 수신 시:     
      IMAP 또는 POP3를 통해 메일 서버에서 메일을 다운로드하거나 동기화.    
      웹메일(예: Gmail, Naver Mail):    
      웹브라우저는 HTTP/HTTPS를 통해 메일 서버와 통신.    
      내부적으로 서버는 여전히 SMTP를 사용하여 송신하고, IMAP/POP3로 수신을 관리함.
---
| **구분**         | **SMTP**                                           | **POP3**                                      | **IMAP**                                        |
|------------------|----------------------------------------------------|-----------------------------------------------|-------------------------------------------------|
| **기능**         | 메일 **전송**                              | 메일 **수신** (다운로드)                      | 메일 **수신 및 동기화** (서버에 저장)           |
| **주요 용도**    | 발신 메일을 **서버로 전달**하거나 **서버 간 전송** | 수신 메일을 **다운로드**하여 **로컬 저장**    | 서버와 **동기화**하면서 메일 관리               |
| **프로토콜 방향**| **클라이언트 → 서버(발신)**                        | **서버 → 클라이언트(수신)**                    | **서버 ↔ 클라이언트(양방향)**                   |
| **연결 방식**    | 중계 서버(메일 릴레이 서버) 사용                   | 메일을 **로컬에 저장**하고 서버에서 삭제 가능 | 메일을 **서버에 저장**하고 필요 시 동기화       |
| **동기화 지원**  | ❌ (전송만 가능, 동기화 불가)                       | ❌ (다운로드 후 서버 메일 삭제 가능)           | ✅ (다중기기 동기화 및 폴더 구조 유지 가능)      |
| **오프라인 사용**| ❌ (연결 필요)                                     | ✅ (로컬 저장된 메일 사용 가능)               | ❌ (서버 접속 필요, 일부 오프라인 캐시 지원)    |

---
SMTP: "에스 엠 티 피"
POP3: "피 오 피 쓰리"
IMAP: "아이 맵"

### **요약**  
- **SMTP**: 메일 서버 간 전송을 담당.  
- **POP3**: 메일을 다운로드하여 로컬에서 관리. 서버와 동기화 불가.  
- **IMAP**: 서버와 동기화하며 메일을 관리. 여러 기기에서 동일한 메일함 유지.  

현대에는 **SMTP + IMAP** 조합이 주로 사용되며, **POP3**는 구형 시스템에서 일부 사용된다.
