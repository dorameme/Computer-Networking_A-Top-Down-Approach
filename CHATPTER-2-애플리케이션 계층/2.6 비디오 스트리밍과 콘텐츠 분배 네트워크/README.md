## 2.6 비디오 스트리밍과 콘텐츠 분배 네트워크

### 2.6.1 인터넷 비디오

#### 비디오의 주요 특징

- **압축 가능성**: 비디오 품질과 비트 전송률은 반비례한다.
  - 비트 전송률이 높을수록 이미지 품질이 향상된다.
- **높은 비트 전송률 요구**

#### 네트워킹 요구사항

- 압축된 비디오의 스트리밍을 위해 평균 처리량이 필요하다.
- 동일한 비디오를 여러 품질로 압축하여 다양한 대역폭 상황에 대응할 수 있다.
- **프레임 속도와 품질 관계**:
  - 초당 프레임 수(FPS)는 동영상의 부드러움에 영향을 미친다.
  - 고해상도 동영상은 더 높은 비트 전송률과 저장 용량을 요구한다.

---

### 2.6.2 HTTP 스트리밍 및 DASH

#### HTTP 스트리밍

HTTP 스트리밍에서 비디오는 HTTP 서버에 저장된 일반 파일로, 클라이언트가 URL에 대한 HTTP GET 요청을 통해 데이터를 받는다. 버퍼의 바이트 수가 임계값을 초과하면 재생을 시작한다.

#### 문제점

- 가용 대역폭에 상관없이 동일한 인코딩된 비디오를 전송받는다.

#### DASH (Dynamic Adaptive Streaming over HTTP)

- **다양한 비디오 버전**: 비트율과 품질 수준이 다른 여러 버전으로 인코딩된다.
- **동적인 클라이언트 요청**: 클라이언트는 가용 대역폭에 따라 적절한 비디오 조각 단위를 선택하여 요청한다.
- **매니페스트 파일**: HTTP 서버는 비트율에 따른 URL을 매니페스트 파일 형태로 제공하며, 클라이언트는 이를 바탕으로 요청을 동적으로 조정한다.

DASH는 클라이언트가 상황에 따라 품질 수준을 변경할 수 있도록 허용한다.

#### 추가 지식: 매니페스트 파일의 역할

- 매니페스트 파일은 비디오의 모든 버전과 해당 URL을 포함한다.
- 클라이언트는 이를 참고하여 대역폭 상황에 맞는 비디오를 선택한다.
- 주로 MPD(Media Presentation Description) 형식으로 제공된다.

---

### 2.6.3 콘텐츠 분배 네트워크 (CDN)

#### CDN 개요

CDN은 다수의 분산된 서버를 통해 비디오 및 웹 콘텐츠 데이터를 저장하고 사용자에게 전달한다.

단일 데이터 센터를 통해 서비스를 제공하는 단점(병목현상, 반복 전송 비용, 단일 장애점)을 해결하기 위해 사용된다.

#### CDN 설계 철학

1. **Enter Deep**:

   - 접속 네트워크 깊숙이 CDN 서버를 배치하여 사용자와 가까운 위치에서 콘텐츠를 제공한다.
   - ISP의 접속 네트워크에 서버 클러스터를 구축하여 지연시간과 처리율을 개선한다.

2. **Bring Home**:

   - 핵심 위치에 대형 서버 클러스터를 배치하여 운영 비용을 절감한다.
   - ISP 대신 인터넷 교환 지점(IXP)에 클러스터를 배치한다.

#### CDN 동작 원리

1. 사용자가 URL을 입력하면 로컬 DNS가 CDN 서버로 연결한다.
2. 클라이언트는 가장 적합한 CDN 서버에서 비디오를 수신한다.
3. 요청 과정에서 DNS 리다이렉션을 통해 클러스터를 선택한다.

#### 클러스터 선택 정책

1. **Geographically Closest**: 지리적으로 가까운 클러스터를 선택한다.
2. **Real-time Measurements**: 네트워크 지연 및 손실을 실시간 측정하여 최적의 클러스터를 선택한다.

#### 푸시 캐싱 (Push Caching)

- **작동 방식**: 자주 사용될 것으로 예상되는 콘텐츠를 미리 CDN 서버에 전송하여 저장한다.
- **특징**:
  - 초기 요청 지연을 줄인다.
  - 예상되는 인기 콘텐츠나 특정 시간에 자주 요청될 콘텐츠에 적합하다.
- **장점**: 콘텐츠 준비가 미리 완료되어 빠른 응답이 가능하다.
- **단점**: 예측이 틀릴 경우 자원이 낭비될 수 있다.

#### 풀 캐싱 (Pull Caching)

- **작동 방식**: 콘텐츠 요청이 있을 때 중앙 서버에서 데이터를 가져와 CDN 서버에 저장하고, 이후 요청 시 캐시된 데이터를 제공한다.
- **특징**:
  - 자주 사용되지 않는 콘텐츠를 필요할 때만 캐싱한다.
  - 실시간 요청에 따라 콘텐츠가 추가된다.
- **장점**:  모든 콘텐츠를 미리 준비할 필요가 없어 자원 효율적이다.
- **단점**:  초기 요청 시 지연이 발생할 수 있다.

#### 추가 지식: CDN 캐싱 정책

- 푸시 캐싱은 주로 예상되는 트래픽이 높은 지역에 적용된다.
- 풀 캐싱은 트래픽이 예측하기 어려운 경우 효율적이다.
- 하이브리드 방식으로 푸시와 풀을 혼합 사용하여 최적의 성능을 제공할 수 있다.

---

### 2.6.4 사례 연구: 넷플릭스와 유튜브

#### 넷플릭스

1. **콘텐츠 처리**:
   - 다양한 기기와 비트율에 적합한 형식으로 비디오를 생성한다.
   - DASH를 사용하여 여러 비트율 버전을 제작한다.

2. **CDN 구축**:
   - IXP와 ISP에 서버 랙(rack)을 배치하여 푸시 캐싱(push caching)을 통해 자주 사용되는 콘텐츠를 미리 서버에 저장한다. (요청에 따라 그때 그때 동적이진 않고, 정해진 시간에 자주 사용되는 콘텐츠 위주)
   - 서버 랙은 10Gbps 이더넷 포트와 100TB 이상의 스토리지를 포함한다.

3. **클라이언트 동작**:
   - 사용자가 요청한 콘텐츠를 가장 적합한 서버에서 제공한다.
   - 로컬 ISP의 CDN 서버 랙을 우선적으로 사용하며, 필요시 근처 IXP의 서버를 활용한다.

#### 추가 지식: 넷플릭스의 푸시 캐싱 방식

- 특정 시간대(예: 밤 시간대) 인기 콘텐츠를 미리 서버로 전송하여 트래픽을 분산한다.
- 지역별 인기 콘텐츠 패턴에 따라 효율적으로 저장소를 관리한다.

#### 유튜브

- 자체 CDN을 사용하며 클라이언트와 클러스터 간 RTT를 기준으로 최적의 클러스터를 선택한다.
- 작업 부하가 많을 경우, 더 멀리 있는 CDN을 선택하여 분산 처리한다.

#### 추가 지식: 유튜브의 효율성 강화

- HTTP byte-range 요청을 사용하여 사용자가 필요로 하는 특정 비디오 조각만 전송하여 대역폭 낭비를 줄인다.
- 사용자 행동(예: 재생 위치 조정, 조기 종료)을 기반으로 전송량을 동적으로 관리한다.

